<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Classroom Simulator</title>
  
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

  <style>
    /* 引入現代字體 */
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');
    
    body { margin: 0; overflow: hidden; font-family: 'Roboto', sans-serif; }

    /* === UI 層 (HUD) === */
    #ui-layer {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* 讓點擊穿透到 3D */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    /* 頂部狀態列 */
    .top-bar {
      background: rgba(0,0,0,0.6);
      color: #00e5ff;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      backdrop-filter: blur(5px);
    }
    .status-dot { width: 10px; height: 10px; background: #00e5ff; border-radius: 50%; display: inline-block; margin-right: 5px; box-shadow: 0 0 10px #00e5ff; }

    /* 右側資料面板 (預設隱藏) */
    #data-card {
      position: absolute;
      right: 20px;
      top: 80px;
      width: 320px;
      background: rgba(16, 30, 50, 0.95);
      border: 1px solid #00e5ff;
      border-radius: 8px;
      color: white;
      padding: 20px;
      transform: translateX(120%); /* 隱藏 */
      transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      pointer-events: auto;
      box-shadow: -10px 10px 30px rgba(0,0,0,0.5);
    }
    #data-card.active { transform: translateX(0); }
    
    .card-header { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; font-size: 18px; font-weight: bold; color: #00e5ff; display: flex; align-items: center; gap: 10px;}
    .card-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: white;}
    
    .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
    .stat-label { color: #8899a6; }
    .stat-val { font-weight: bold; }
    .stat-desc { font-size: 13px; color: #b0bec5; line-height: 1.4; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #333; }

    /* 底部提示 */
    .bottom-hint {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.7);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-size: 12px;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    }

    /* Loading 畫面 */
    #loader {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: #000; color: #00e5ff;
      display: flex; justify-content: center; align-items: center;
      z-index: 9999;
      transition: opacity 0.5s;
    }
  </style>
</head>

<body>

  <div id="loader">LOADING SIMULATION...</div>

  <div id="ui-layer">
    <div class="top-bar">
      <div><span class="status-dot"></span>VILL SIMULATOR</div>
      <div>MODULE 1: GEOGRAPHY</div>
    </div>
    
    <div id="data-card">
      <div class="card-header">
        <div class="card-icon" id="card-icon" style="background:#00e5ff">i</div>
        <span id="card-title">Select a Marker</span>
      </div>
      <div id="card-content">
        </div>
    </div>

    <div class="bottom-hint">Drag to Rotate • Click Map to Activate • Select Pins</div>
  </div>

  <a-scene 
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;"
    cursor="rayOrigin: mouse" 
    raycaster="objects: .clickable">
    
    <a-assets>
      <img id="room-bg" src="https://live.staticflickr.com/65535/52285608679_2003c44158_k.jpg" crossorigin="anonymous">
      <img id="map-tex" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png" crossorigin="anonymous">
      <img id="wood-tex" src="https://cdn.glitch.global/2a3af8bb-e7b2-4e50-8ce2-68e3e8cf4538/wood.jpg?v=1603223030300" crossorigin="anonymous">
    </a-assets>

    <a-sky src="#room-bg" rotation="0 -90 0"></a-sky>

    <a-light type="ambient" intensity="0.8" color="#ffffff"></a-light>
    <a-light type="directional" position="2 4 2" intensity="1.5" castShadow="true"></a-light>
    <a-light type="point" position="0 2 0" intensity="0.5" color="#ffeecc"></a-light>

    <a-entity 
      camera 
      look-controls="enabled: false"
      orbit-controls="target: 0 0.5 0; minDistance: 2; maxDistance: 5; initialPosition: 0 2 3; enablePan: false; zoomSpeed: 1.5">
    </a-entity>

    <a-entity position="0 0 0">
      
      <a-cylinder 
        position="0 0 0" 
        radius="1.5" 
        height="0.05" 
        color="#5d4037" 
        material="src: #wood-tex; roughness: 0.8"
        shadow="receive: true">
      </a-cylinder>
      <a-cylinder position="0 -0.5 0" radius="0.2" height="1" color="#333"></a-cylinder>

      <a-image 
        id="flat-map"
        class="clickable"
        src="#map-tex" 
        width="1.2" height="1.6" 
        rotation="-90 0 0" 
        position="0 0.04 0"
        opacity="0.9"
        animation__hover="property: scale; to: 1.05 1.05 1; dur: 300; startEvents: mouseenter; pauseEvents: mouseleave; dir: alternate">
        <a-text value="CLICK TO START" align="center" position="0 0 0.1" color="yellow" width="4" shader="msdf" font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Bold.json"></a-text>
      </a-image>

      <a-entity id="ar-map-group" visible="false" scale="0.1 0.1 0.1">
        
        <a-box position="0 0.1 0" width="1.3" height="0.05" depth="1.7" color="#001" material="opacity: 0.8; transparent: true" border="1px solid cyan"></a-box>
        <a-plane position="0 0.13 0" width="1.3" height="1.7" rotation="-90 0 0" color="#00e5ff" material="wireframe: true"></a-plane>

        <a-image src="#map-tex" width="1.2" height="1.6" rotation="-90 0 0" position="0 0.2 0"></a-image>

        <a-entity position="0.2 0.2 -0.5" class="clickable pin" data-type="samsung">
          <a-ring radius-inner="0.05" radius-outer="0.06" color="#ff1744" rotation="-90 0 0">
             <a-animation attribute="scale" to="3 3 3" dur="2000" repeat="indefinite" easing="linear"></a-animation>
             <a-animation attribute="material.opacity" from="1" to="0" dur="2000" repeat="indefinite" easing="linear"></a-animation>
          </a-ring>
          <a-sphere radius="0.08" color="#ff1744" position="0 0.15 0"></a-sphere>
          <a-cone radius-bottom="0.01" radius-top="0.08" height="0.15" color="#ff1744" position="0 0.075 0"></a-cone>
          <a-text value="SAMSUNG" look-at="[camera]" position="0 0.35 0" align="center" color="white" width="3" shader="msdf" font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Bold.json"></a-text>
        </a-entity>

        <a-entity position="0.4 0.2 -0.4" class="clickable pin" data-type="apple">
          <a-sphere radius="0.08" color="#eeeeee" position="0 0.15 0"></a-sphere>
          <a-cone radius-bottom="0.01" radius-top="0.08" height="0.15" color="#eeeeee" position="0 0.075 0"></a-cone>
          <a-text value="APPLE" look-at="[camera]" position="0 0.35 0" align="center" color="white" width="3" shader="msdf" font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Bold.json"></a-text>
        </a-entity>

        <a-entity position="0.7 0.2 -0.1" class="clickable pin" data-type="port">
           <a-ring radius-inner="0.05" radius-outer="0.06" color="#00e5ff" rotation="-90 0 0">
             <a-animation attribute="scale" to="3 3 3" dur="2000" repeat="indefinite" easing="linear"></a-animation>
             <a-animation attribute="material.opacity" from="1" to="0" dur="2000" repeat="indefinite" easing="linear"></a-animation>
          </a-ring>
          <a-sphere radius="0.08" color="#00e5ff" position="0 0.15 0"></a-sphere>
          <a-cone radius-bottom="0.01" radius-top="0.08" height="0.15" color="#00e5ff" position="0 0.075 0"></a-cone>
          <a-text value="PORT" look-at="[camera]" position="0 0.35 0" align="center" color="white" width="3" shader="msdf" font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Bold.json"></a-text>
        </a-entity>

      </a-entity>

    </a-entity>
  </a-scene>

  <script>
    // 移除 Loading
    document.querySelector('a-scene').addEventListener('loaded', () => {
      document.getElementById('loader').style.opacity = '0';
      setTimeout(() => document.getElementById('loader').remove(), 500);
    });

    // 資料庫
    const dataDB = {
      'samsung': {
        color: '#ff1744',
        icon: 'S',
        html: `
          <div class="stat-row"><span class="stat-label">Location</span> <span class="stat-val">Bac Ninh</span></div>
          <div class="stat-row"><span class="stat-label">Investment</span> <span class="stat-val">$19 Billion</span></div>
          <div class="stat-row"><span class="stat-label">Workforce</span> <span class="stat-val">40,000+</span></div>
          <div class="stat-desc">北越最大的 FDI 投資項目。此處生產全球近 50% 的 Galaxy 手機。享有 "4免9減半" 稅務優惠。</div>
        `
      },
      'apple': {
        color: '#eeeeee',
        icon: 'A',
        html: `
          <div class="stat-row"><span class="stat-label">Partners</span> <span class="stat-val">Luxshare / Foxconn</span></div>
          <div class="stat-row"><span class="stat-label">Location</span> <span class="stat-val">Bac Giang</span></div>
          <div class="stat-row"><span class="stat-label">Product</span> <span class="stat-val">iPad / Watch</span></div>
          <div class="stat-desc">Apple 供應鏈去風險化 (De-risking) 的關鍵基地。正從中國移轉 MacBook 產線至此。</div>
        `
      },
      'port': {
        color: '#00e5ff',
        icon: 'P',
        html: `
          <div class="stat-row"><span class="stat-label">Name</span> <span class="stat-val">Hai Phong Port</span></div>
          <div class="stat-row"><span class="stat-label">Type</span> <span class="stat-val">Deep Water</span></div>
          <div class="stat-row"><span class="stat-label">Capacity</span> <span class="stat-val">92M Tons/Yr</span></div>
          <div class="stat-desc">北越出口咽喉。連接電子產業聚落與歐美市場，距離北寧僅 1.5 小時車程。</div>
        `
      }
    };

    // 邏輯控制
    const flatMap = document.getElementById('flat-map');
    const arGroup = document.getElementById('ar-map-group');
    const dataCard = document.getElementById('data-card');
    const cardTitle = document.getElementById('card-title');
    const cardContent = document.getElementById('card-content');
    const cardIcon = document.getElementById('card-icon');

    // 1. 點擊平面地圖 -> 展開 3D 地圖
    flatMap.addEventListener('click', () => {
      // 隱藏平面
      flatMap.setAttribute('visible', 'false');
      // 顯示 3D
      arGroup.setAttribute('visible', 'true');
      // 動畫：彈出
      arGroup.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 1000; easing: easeOutElastic');
    });

    // 2. 點擊標記 -> 顯示資料
    document.querySelectorAll('.pin').forEach(pin => {
      pin.addEventListener('click', function(evt) {
        evt.stopPropagation(); // 避免點到其他東西
        
        const type = this.getAttribute('data-type');
        const data = dataDB[type];

        // 更新 UI
        cardTitle.innerText = type.toUpperCase();
        cardTitle.style.color = data.color;
        cardContent.innerHTML = data.html;
        cardIcon.style.background = data.color;
        cardIcon.innerText = data.icon;
        cardIcon.style.color = type === 'apple' ? 'black' : 'white';
        
        // 顯示卡片
        dataCard.classList.add('active');

        // Pin 的微小回饋動畫
        const originalScale = this.getAttribute('scale');
        this.setAttribute('animation', 'property: scale; to: 1.2 1.2 1.2; dur: 100; dir: alternate; loop: 2');
      });
    });

    // 點擊背景關閉卡片
    document.querySelector('a-sky').addEventListener('click', () => {
      dataCard.classList.remove('active');
    });
  </script>
</body>
</html>
