<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: V34 Pin-Aligned Spatial UI</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; background-color: #000; }

    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; display: flex; flex-direction: column; justify-content: space-between; }
    .header { background: rgba(20, 30, 40, 0.9); border-bottom: 3px solid #00d2ff; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; pointer-events: auto; }
    .title { color: #00d2ff; font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: bold; letter-spacing: 2px; }
    .subtitle { color: #fff; font-size: 14px; margin-left: 15px; opacity: 0.8; }
    .controls-hint { text-align: center; padding: 15px; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); color: #ccc; font-size: 13px; text-shadow: 1px 1px 2px black; }
  </style>

  <script>
    AFRAME.registerComponent('smart-label', {
      tick: function () {
        var cameraEl = this.el.sceneEl.camera && this.el.sceneEl.camera.el;
        if (!cameraEl) return;
        this.el.object3D.quaternion.copy(cameraEl.object3D.quaternion);
      }
    });

    AFRAME.registerComponent('pin-hover', {
      schema: {
        target: { type: 'selector' },
        overScale: { default: 1.35 },
        dur: { default: 140 }
      },
      init: function () {
        const el = this.el;
        const targetEl = this.data.target || el;

        const base = targetEl.getAttribute('scale') || { x: 1, y: 1, z: 1 };
        this.baseScale = { x: base.x, y: base.y, z: base.z };

        const over = {
          x: this.baseScale.x * this.data.overScale,
          y: this.baseScale.y * this.data.overScale,
          z: this.baseScale.z * this.data.overScale
        };

        const applyAnim = (to) => {
          targetEl.setAttribute('animation__hover', `
            property: scale;
            to: ${to.x} ${to.y} ${to.z};
            dur: ${this.data.dur};
            easing: easeOutQuad;
          `);
        };

        el.addEventListener('mouseenter', () => applyAnim(over));
        el.addEventListener('mouseleave', () => applyAnim(this.baseScale));
      }
    });
  </script>
</head>

<body>

  <div id="ui-layer">
    <div class="header">
      <div><span class="title">VILL SYSTEM</span><span class="subtitle">Module: North Vietnam Supply Chain</span></div>
      <div style="background:#00d2ff; color:black; font-size:12px; padding:4px 10px; border-radius:4px; font-weight:bold;">SPATIAL MODE</div>
    </div>
    <div class="controls-hint">ğŸ–±ï¸ å·¦éµæ‹–æ›³: æ—‹è½‰ | ğŸ–±ï¸ æ»¾è¼ª: ç¸®æ”¾ | ğŸ–±ï¸ å³éµæ‹–æ›³: å¹³ç§» | ğŸ‘† é»æ“Šæ¨™è¨˜æŸ¥çœ‹åˆ†æ</div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png'">
      <canvas id="floor-tex" width="512" height="512"></canvas>
      <canvas id="wood-tex" width="512" height="512"></canvas>
      <canvas id="wall-tex" width="512" height="512"></canvas>
      <canvas id="ui-bg-tex" width="512" height="512"></canvas>
      <canvas id="ui-header-tex" width="512" height="100"></canvas>

      <canvas id="tile-tex" width="512" height="512"></canvas>
      <canvas id="ceiling-tex" width="512" height="512"></canvas>
      <canvas id="board-tex" width="1024" height="512"></canvas>
      <canvas id="window-tex" width="512" height="512"></canvas>
      <canvas id="poster-tex" width="512" height="512"></canvas>
      <canvas id="shelf-tex" width="512" height="512"></canvas>
      <canvas id="door-tex" width="512" height="512"></canvas>
    </a-assets>

    <a-sky color="#87CEEB"></a-sky>

    <!-- Floor -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20"
             material="src: #tile-tex; roughness: 0.95; metalness: 0.0; repeat: 6 6"></a-plane>

    <!-- Ceiling -->
    <a-plane position="0 5 0" rotation="90 0 0" width="20" height="20"
             material="src:#ceiling-tex; roughness: 0.9; repeat: 4 4"></a-plane>

    <!-- Walls -->
    <a-box position="0 2.5 -6" width="20" height="5" depth="0.2" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="6 2.5 0" width="0.2" height="5" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 4 0" width="0.2" height="2" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 1 0" width="0.2" height="2" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 2.5 5" width="0.2" height="1" depth="10" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 2.5 -5" width="0.2" height="1" depth="10" color="#fdf5e6" material="src:#wall-
