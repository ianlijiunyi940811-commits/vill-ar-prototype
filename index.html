<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Professional Classroom Sim</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Rajdhani:wght@600&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; }

    /* === é ‚ç´š UI è¨­è¨ˆ (HUD) === */
    #ui-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 10;
    }
    
    .nav-header {
      background: rgba(13, 27, 42, 0.9); padding: 20px 40px;
      border-bottom: 2px solid #00ffcc; display: flex; justify-content: space-between;
    }
    .nav-title { font-family: 'Rajdhani'; color: #00ffcc; font-size: 28px; letter-spacing: 2px; }

    /* äº’å‹•è³‡è¨Šå¡ç‰‡ */
    #data-card {
      position: absolute; top: 120px; right: 30px; width: 320px;
      background: rgba(255, 255, 255, 0.95); border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 25px;
      transform: translateX(150%); transition: transform 0.4s ease;
      pointer-events: auto; border-left: 8px solid #007bff;
    }
    #data-card.active { transform: translateX(0); }
    .card-title { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
    .card-body { font-size: 15px; color: #555; line-height: 1.6; }

    .control-hint {
      position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: white; padding: 10px 30px;
      border-radius: 50px; font-size: 14px;
    }
  </style>
</head>

<body>

  <div id="ui-overlay">
    <div class="nav-header">
      <div class="nav-title">VILL CLASSROOM SIMULATOR</div>
      <div style="color:white; font-size:14px;">Module 1: Economic Geography</div>
    </div>

    <div id="data-card">
      <div class="card-title" id="node-title">å ´æ™¯åˆ†æ</div>
      <div class="card-body" id="node-content">è«‹é»æ“Šåœ°åœ–æ¨™è¨˜æŸ¥çœ‹æ•¸æ“šã€‚</div>
    </div>

    <div class="control-hint">ğŸ–±ï¸ æ»¾è¼ª: æ”¾å¤§ç¸®å° | ğŸ–±ï¸ å·¦éµ: æ—‹è½‰è§’åº¦ | ğŸ‘† é»æ“Šæ¨™è¨˜: æŸ¥çœ‹æ•¸æ“š</div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="map-img" src="./map.jpg">
      <canvas id="wood-tex" width="512" height="512"></canvas>
    </a-assets>

    <a-sky color="#87CEEB"></a-sky> <a-box position="0 2.5 0" width="12" height="5" depth="12" material="color: #f5f5f5; side: back;"></a-box>
    <a-plane position="0 0.01 0" rotation="-90 0 0" width="12" height="12" color="#e0e0e0"></a-plane> <a-plane position="-5.9 2.5 0" rotation="0 90 0" width="4" height="2" material="color: #ffffff; emissive: #ffffff; emissiveIntensity: 0.5"></a-plane>

    <a-light type="ambient" intensity="0.5"></a-light>
    <a-light type="directional" position="2 4 3" intensity="0.8" castShadow="true"></a-light>
    <a-light type="spot" position="0 4.5 0" target="#table" intensity="1" angle="30"></a-light>

    <a-entity 
      id="cam-rig"
      camera
      look-controls="enabled: false"
      orbit-controls="target: 0 1 0; minDistance: 1.5; maxDistance: 6; initialPosition: 0 2 3.5; screenSpacePanning: true; enableDamping: true; dampingFactor: 0.1;">
    </a-entity>

    <a-entity id="table" position="0 0 0">
      <a-cylinder position="0 0.8 0" radius="1.4" height="0.1" material="src: #wood-tex; roughness: 0.8"></a-cylinder>
      <a-cylinder position="0 0.4 0" radius="0.15" height="0.8" color="#3e2723"></a-cylinder>
      <a-cylinder position="0 0.02 0" radius="0.6" height="0.05" color="#222"></a-cylinder>
    </a-entity>

    <a-entity id="step1-flat" position="0 0.86 0" rotation="-90 0 0">
      <a-plane width="1" height="1.4" color="#fff" class="clickable" onclick="show3DMap()">
        <a-image src="#map-img" width="0.9" height="1.3" position="0 0 0.01"></a-image>
        <a-text value="é»æ“Šé–‹å•Ÿ AR åœ°åœ–" align="center" position="0 0 0.02" color="red" scale="0.6 0.6 0.6"></a-text>
      </a-plane>
    </a-entity>

    <a-entity id="step2-3d" position="0 1.2 0" visible="false" scale="0.1 0.1 0.1">
      
      <a-box width="1.6" height="0.05" depth="2" color="#001" opacity="0.8" position="0 -0.1 0"></a-box>
      <a-image src="#map-img" width="1.4" height="1.8" rotation="-90 0 0" position="0 0 0"></a-image>

      <a-entity position="-0.1 0.1 -0.5" class="clickable pin" data-id="samsung">
        <a-sphere radius="0.06" color="#ff1744" position="0 0.15 0">
           <a-animation attribute="scale" from="1 1 1" to="1.2 1.2 1.2" dur="1000" repeat="indefinite" direction="alternate"></a-animation>
        </a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ff1744" position="0 0.07 0"></a-cone>
      </a-entity>

      <a-entity position="0.2 0.1 -0.4" class="clickable pin" data-id="apple">
        <a-sphere radius="0.06" color="#ffffff" position="0 0.15 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ffffff" position="0 0.07 0"></a-cone>
      </a-entity>

      <a-entity position="0.5 0.1 0.1" class="clickable pin" data-id="port">
        <a-sphere radius="0.06" color="#00e5ff" position="0 0.15 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#00e5ff" position="0 0.07 0"></a-cone>
      </a-entity>

    </a-entity>

  </a-scene>

  <script>
    // ç”Ÿæˆæœ¨ç´‹ç´‹ç†
    const canvas = document.getElementById('wood-tex');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#5d4037'; ctx.fillRect(0,0,512,512);
    ctx.strokeStyle = '#3e2723'; ctx.lineWidth = 5;
    for(let i=0; i<30; i++) {
      ctx.beginPath(); ctx.moveTo(0, Math.random()*512); 
      ctx.bezierCurveTo(100, Math.random()*512, 400, Math.random()*512, 512, Math.random()*512);
      ctx.stroke();
    }

    const flatMap = document.getElementById('step1-flat');
    const arMap = document.getElementById('step2-3d');
    const card = document.getElementById('data-card');

    // å•Ÿå‹• 3D åœ°åœ–
    window.show3DMap = function() {
      flatMap.setAttribute('visible', 'false');
      arMap.setAttribute('visible', 'true');
      arMap.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutBack');
      document.querySelector('.control-hint').innerText = "é»æ“Š Pin æ¨™è¨˜æŸ¥çœ‹åŠå°é«”ç”¢æ¥­æ•¸æ“š";
    };

    // è³‡æ–™åº«
    const db = {
      samsung: { title: "SAMSUNG (Bac Ninh)", body: "åŒ—è¶Šæœ€å¤§å°è£æ¸¬è©¦åŸºåœ° [cite: 3]ã€‚æŠ•è³‡é¡é” 190 å„„ç¾å…ƒï¼Œè²¢ç»è¶Šå—å‡ºå£è¿‘ 20% [cite: 88]ã€‚" },
      apple: { title: "APPLE / FOXCONN", body: "åŸ·è¡Œ 'ä¸­åœ‹åŠ ä¸€' ç­–ç•¥ä¹‹é—œéµç¯€é» [cite: 3, 29]ã€‚å°ˆæ³¨æ–¼ iPad èˆ‡é«˜éšç©¿æˆ´è£ç½®ä¹‹çµ„è£èˆ‡é›¶ä»¶ä¾›æ‡‰ [cite: 88]ã€‚" },
      port: { title: "HAI PHONG PORT", body: "åŒ—è¶Šé›»å­ç”¢æ¥­å‡ºå£å’½å–‰ [cite: 88]ã€‚é€£çµå…¨çƒä¾›æ‡‰éˆä¹‹æ ¸å¿ƒæ¨ç´ [cite: 29]ã€‚" }
    };

    // ç¶å®šæ¨™è¨˜é»æ“Š
    document.querySelectorAll('.pin').forEach(pin => {
      pin.addEventListener('click', (e) => {
        e.stopPropagation();
        const id = pin.getAttribute('data-id');
        const data = db[id];
        document.getElementById('node-title').innerText = data.title;
        document.getElementById('node-content').innerText = data.body;
        card.classList.add('active');
      });
    });

    // é»æ“ŠèƒŒæ™¯é—œé–‰è³‡è¨Šå¡
    document.querySelector('a-scene').addEventListener('click', (e) => {
      if (!e.target.closest('.clickable')) card.classList.remove('active');
    });
  </script>
</body>
</html>
