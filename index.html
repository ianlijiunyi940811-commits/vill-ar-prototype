<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Strategic Command</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  
  <style>
    /* 讓字體更像科技儀表板 */
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');
    
    body { margin: 0; overflow: hidden; font-family: 'Rajdhani', sans-serif; }
    
    /* UI: 頂部狀態列 */
    #hud-top {
      position: absolute;
      top: 0; left: 0; width: 100%;
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
      color: #00e5ff;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      z-index: 10;
      pointer-events: none;
    }
    .hud-text { font-size: 18px; letter-spacing: 1px; }

    /* UI: 聊天室 (半透明玻璃質感) */
    #chat-panel {
      position: absolute;
      bottom: 0; left: 0; width: 100%; height: 35%;
      background: rgba(10, 25, 47, 0.95); /* 深藍色科技感背景 */
      border-top: 2px solid #00e5ff;
      display: flex;
      flex-direction: column;
      z-index: 20;
      border-radius: 20px 20px 0 0;
    }

    #chat-history {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      color: white;
      font-family: sans-serif;
    }

    .msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 8px; font-size: 14px; line-height: 1.4; }
    .ai { background: rgba(0, 229, 255, 0.15); border-left: 3px solid #00e5ff; color: #e0f7fa; }
    .user { background: rgba(76, 175, 80, 0.2); border-right: 3px solid #4caf50; color: white; text-align: right; margin-left: auto; max-width: 80%; }

    #input-area {
      display: flex;
      padding: 15px;
      background: rgba(0,0,0,0.3);
    }
    
    #chat-input {
      flex: 1;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid #555;
      color: white;
      border-radius: 4px;
      outline: none;
    }
    
    #send-btn {
      margin-left: 10px;
      padding: 0 20px;
      background: #00e5ff;
      color: #000;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>

<body style="margin: 0px; overflow: hidden;">

  <div id="hud-top">
    <div class="hud-text">VILL SYSTEM ONLINE</div>
    <div class="hud-text">MODULE: SUPPLY CHAIN</div>
  </div>

  <a-scene 
    embedded 
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    renderer="logarithmicDepthBuffer: true; colorManagement: true;"
    vr-mode-ui="enabled: false">
    
    <a-assets>
      <img id="map-tex" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png">
    </a-assets>

    <a-marker preset="hiro" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
      
      <a-image 
        src="#map-tex" 
        rotation="-90 0 0" 
        width="3" height="4" 
        position="0 0.1 0"
        opacity="0.9">
      </a-image>

      <a-entity position="0.3 0.1 -1.2">
        <a-ring color="#ff1744" radius-inner="0.05" radius-outer="0.1" rotation="-90 0 0">
          <a-animation attribute="geometry.radius-outer" to="0.3" dur="2000" repeat="indefinite" easing="linear"></a-animation>
          <a-animation attribute="material.opacity" from="1" to="0" dur="2000" repeat="indefinite" easing="linear"></a-animation>
        </a-ring>
        <a-cylinder color="#ff1744" height="0.5" radius="0.02" position="0 0.25 0"></a-cylinder>
        <a-box color="black" depth="0.1" height="0.2" width="0.8" position="0 0.6 0" opacity="0.8"></a-box>
        <a-text value="SAMSUNG HUB" align="center" position="0 0.6 0.06" scale="0.5 0.5 0.5" color="#fff"></a-text>
      </a-entity>

      <a-entity position="0.8 0.1 -0.5">
        <a-cylinder color="#2979ff" height="0.3" radius="0.02" position="0 0.15 0"></a-cylinder>
        <a-text value="HAI PHONG PORT" align="center" position="0 0.4 0" scale="0.6 0.6 0.6" color="#2979ff"></a-text>
      </a-entity>

      <a-entity line="start: 0.3 0.2 -1.2; end: 0.8 0.2 -0.5; color: #ffeb3b; opacity: 1"></a-entity>
      
      <a-entity position="-1.2 0.5 -1.5" rotation="-45 45 0">
        <a-plane width="1.5" height="1" color="#000" opacity="0.7"></a-plane>
        <a-text 
          value="STRATEGY: China Plus One\n\nTARGET: Bac Ninh\nTAX: 0% (4 Years)\nRISK: Power Grid" 
          position="-0.7 0 0.1" 
          align="left" 
          width="2.5"
          font="sourcecodepro">
        </a-text>
      </a-entity>

    </a-marker>
    
    <a-entity camera></a-entity>
  </a-scene>

  <div id="chat-panel">
    <div id="chat-history">
      <div class="msg ai">
        <strong>VILL AI:</strong> System initialized. <br>I have highlighted the <strong>Samsung Hub</strong> and <strong>Hai Phong Port</strong>.<br>How can I assist with your risk assessment?
      </div>
    </div>
    <div id="input-area">
      <input type="text" id="chat-input" placeholder="Ask about 'Power' or 'Logistics'...">
      <button id="send-btn">ANALYZE</button>
    </div>
  </div>

  <script>
    const chatHistory = document.getElementById('chat-history');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');

    function addMsg(text, type, sender) {
      const div = document.createElement('div');
      div.className = `msg ${type}`;
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chatHistory.appendChild(div);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function getAIResponse(text) {
      const t = text.toLowerCase();
      if (t.includes('power') || t.includes('electric')) {
        return "Critical Risk Detected: **Summer Power Shortages**. \nOSAT factories in Bac Ninh require 24/7 stability. Recommendation: Investigate backup generator costs.";
      }
      if (t.includes('why') || t.includes('location')) {
        return "Strategic Logic: The **China Plus One** model works here because Bac Ninh is only ~150km from the Chinese border, allowing rapid component import via land.";
      }
      return "Input received. Try analyzing specific factors like **'Tax'**, **'Labor'**, or **'Logistics'** to refine the strategy model.";
    }

    sendBtn.addEventListener('click', () => {
      const txt = chatInput.value.trim();
      if(!txt) return;
      addMsg(txt, 'user', 'CDR. YOU');
      chatInput.value = '';
      setTimeout(() => addMsg(getAIResponse(txt), 'ai', 'VILL AI'), 800);
    });
  </script>
</body>
</html>
