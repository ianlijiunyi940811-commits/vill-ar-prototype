<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL Project: Stable Prototype</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    
    /* 聊天室 UI - 固定在螢幕下方 */
    #chat-container {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 35%; /* 佔據下方 35% 空間 */
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      z-index: 9999; /* 確保在最上層 */
      overflow: hidden;
    }

    #chat-header {
      background: #0d47a1;
      color: white;
      padding: 10px 15px;
      font-weight: bold;
      text-align: center;
    }

    #chat-history {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      font-size: 14px;
    }

    .message { margin-bottom: 8px; padding: 8px 12px; border-radius: 12px; max-width: 80%; }
    .ai-msg { background: #e3f2fd; color: #000; align-self: flex-start; }
    .user-msg { background: #1976d2; color: white; margin-left: auto; }

    #input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid #eee;
      background: white;
    }
    
    #chat-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      outline: none;
    }
    
    #send-btn {
      margin-left: 10px;
      padding: 10px 20px;
      background: #2e7d32; /* 綠色按鈕 */
      color: white;
      border: none;
      border-radius: 20px;
      font-weight: bold;
    }
  </style>
</head>

<body style="margin: 0px; overflow: hidden;">

  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    
    <a-marker preset="hiro">
      
      <a-plane position="0 0 0" rotation="-90 0 0" width="2.5" height="2" color="#e8f5e9" opacity="0.8"></a-plane>

      <a-box position="-0.8 0.25 -0.5" color="#d32f2f" depth="0.5" height="0.5" width="0.5"></a-box>
      <a-text value="Samsung (Bac Ninh)" position="-0.8 0.8 -0.5" align="center" scale="0.8 0.8 0.8" color="black"></a-text>

      <a-sphere position="0.8 0.25 0.5" radius="0.3" color="#1976d2"></a-sphere>
      <a-text value="Hai Phong Port" position="0.8 0.8 0.5" align="center" scale="0.8 0.8 0.8" color="black"></a-text>

      <a-entity line="start: -0.8 0.25 -0.5; end: 0.8 0.25 0.5; color: #fbc02d; opacity: 1"></a-entity>
      <a-text value="Supply Chain Route" position="0 0.4 0" align="center" scale="0.6 0.6 0.6" color="#f57f17"></a-text>

      <a-plane position="0 1.5 -1" width="2.5" height="0.6" color="black" opacity="0.7"></a-plane>
      <a-text value="China Plus One Strategy\nStatus: Active\nTax Incentive: 4 Years" position="0 1.5 -1" align="center" color="white" scale="0.7 0.7 0.7"></a-text>

    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <div id="chat-container">
    <div id="chat-header">VILL AI Coach (Module 1)</div>
    <div id="chat-history">
      <div class="message ai-msg">
        <strong>AI:</strong> Welcome! Point your camera at the Hiro marker to see the Bac Ninh supply chain. How can I help with your strategy assessment?
      </div>
    </div>
    <div id="input-area">
      <input type="text" id="chat-input" placeholder="Ask about 'Supply Chain'...">
      <button id="send-btn">Send</button>
    </div>
  </div>

  <script>
    const chatHistory = document.getElementById('chat-history');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');

    function appendMessage(sender, text, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chatHistory.appendChild(div);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    // 模擬 AI 回應邏輯 (無需 API Key)
    function getSimulatedResponse(msg) {
      const m = msg.toLowerCase();
      if (m.includes('why') || m.includes('china')) {
        return "North Vietnam is chosen for the **China Plus One** strategy due to its proximity to Shenzhen supply chains. This minimizes logistics costs while leveraging lower labor costs. (Tip: Use 'Strategic Proximity' in your report.)";
      }
      if (m.includes('tax') || m.includes('money')) {
        return "Investors in Bac Ninh enjoy a Corporate Income Tax (CIT) exemption for the first 4 years. This is a major incentive for **FDI** (Foreign Direct Investment).";
      }
      if (m.includes('risk') || m.includes('power')) {
        return "A key risk is infrastructure stability, specifically summer power shortages affecting **OSAT** yield rates. Backup power solutions are mandatory.";
      }
      return "Good question. Try asking about 'Tax Incentives', 'Supply Chain', or 'Risks'. I will help you practice your professional ESP terms.";
    }

    sendBtn.addEventListener('click', () => {
      const txt = chatInput.value.trim();
      if (!txt) return;
      
      appendMessage('You', txt, 'user-msg');
      chatInput.value = '';
      
      setTimeout(() => {
        appendMessage('AI', getSimulatedResponse(txt), 'ai-msg');
      }, 600);
    });
  </script>
</body>
</html>
