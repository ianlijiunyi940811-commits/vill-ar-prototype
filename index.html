<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Classroom Simulator</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <script src="https://unpkg.com/aframe-animation-component@5.1.2/dist/aframe-animation-component.min.js"></script>
  
  <style>
    /* UI 字體與風格 */
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Noto+Sans+TC:wght@400;700&display=swap');
    
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; }

    /* === 資訊面板 (右側懸浮) === */
    #info-panel {
      position: absolute;
      top: 20%; right: 20px;
      width: 300px;
      background: rgba(13, 27, 42, 0.95); /* 深藍科技底 */
      border-left: 4px solid #00e5ff;
      padding: 20px;
      color: white;
      border-radius: 8px;
      box-shadow: -5px 5px 20px rgba(0,0,0,0.5);
      transform: translateX(120%); /* 預設隱藏 */
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100;
    }
    
    #info-panel.active { transform: translateX(0); }

    .panel-title { font-family: 'Rajdhani', sans-serif; font-size: 24px; color: #00e5ff; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
    .panel-data { font-size: 14px; line-height: 1.6; color: #e0e0e0; }
    .data-row { margin-bottom: 8px; display: flex; justify-content: space-between; }
    .data-label { color: #888; font-size: 12px; }
    .data-val { font-weight: bold; color: #fff; }

    /* === 底部操作提示 === */
    #hint-bar {
      position: absolute;
      bottom: 30px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px 25px;
      border-radius: 30px;
      pointer-events: none;
      font-size: 14px;
      transition: opacity 0.5s;
    }
  </style>
</head>

<body>

  <div id="info-panel">
    <div class="panel-title" id="panel-title">DATA NODE</div>
    <div class="panel-data" id="panel-content">
      </div>
  </div>

  <div id="hint-bar">請點擊桌上的「平面地圖」以啟動 AR 模型</div>

  <a-scene cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="classroom-bg" src="https://live.staticflickr.com/65535/52285608679_2003c44158_k.jpg" crossorigin="anonymous">
      <img id="map-tex" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png" crossorigin="anonymous">
    </a-assets>

    <a-sky src="#classroom-bg" rotation="0 -90 0" color="#aaa"></a-sky>

    <a-light type="ambient" intensity="0.6"></a-light>
    <a-light type="directional" position="-1 4 2" intensity="0.8" castShadow="true"></a-light>


    <a-entity position="0 -1 -1.5" rotation="0 0 0">

      <a-cylinder radius="2" height="0.1" color="#111" opacity="0.8" position="0 -0.1 0"></a-cylinder>


      <a-image 
        id="flat-map"
        class="clickable"
        src="#map-tex" 
        width="1.2" height="1.8" 
        rotation="-90 0 0" 
        position="0 0.05 0"
        opacity="1"
        animation__hover="property: scale; to: 1.05 1.05 1; dir: alternate; dur: 1000; loop: true; startEvents: mouseenter; pauseEvents: mouseleave">
        
        <a-text value="CLICK TO ACTIVATE" align="center" position="0 0 0.1" color="yellow" scale="0.5 0.5 0.5"></a-text>
      </a-image>


      <a-entity id="ar-map-3d" visible="false" scale="0 0 0">
        
        <a-box width="1.4" height="0.1" depth="2" color="#0d1b2a" opacity="0.95"></a-box>
        <a-image src="#map-tex" width="1.2" height="1.8" rotation="-90 0 0" position="0 0.06 0"></a-image>

        <a-entity position="0.15 0.1 -0.5" class="clickable marker-pin" data-name="Samsung (Bac Ninh)" data-type="samsung">
          <a-box opacity="0" width="0.3" height="0.5" depth="0.3" position="0 0.25 0"></a-box>
          
          <a-cone color="#e91e63" radius-bottom="0.01" radius-top="0.08" height="0.2" position="0 0.15 0">
            <a-animation attribute="position" to="0 0.2 0" dir: alternate; dur: 1000; loop: true></a-animation>
          </a-cone>
          <a-text value="SAMSUNG" align="center" position="0 0.4 0" scale="0.4 0.4 0.4" color="#e91e63" look-at="[camera]"></a-text>
        </a-entity>


        <a-entity position="0.35 0.1 -0.45" class="clickable marker-pin" data-name="Apple / Luxshare" data-type="apple">
          <a-box opacity="0" width="0.3" height="0.5" depth="0.3" position="0 0.25 0"></a-box>
          
          <a-cone color="#fff" radius-bottom="0.01" radius-top="0.08" height="0.2" position="0 0.15 0"></a-cone>
          <a-sphere color="#333" radius="0.05" position="0 0.25 0"></a-sphere>
          <a-text value="APPLE" align="center" position="0 0.4 0" scale="0.4 0.4 0.4" color="#fff" look-at="[camera]"></a-text>
        </a-entity>


        <a-entity position="0.6 0.1 -0.1" class="clickable marker-pin" data-name="Hai Phong Port" data-type="port">
          <a-box opacity="0" width="0.3" height="0.5" depth="0.3" position="0 0.25 0"></a-box>
          
          <a-cone color="#2196f3" radius-bottom="0.01" radius-top="0.08" height="0.2" position="0 0.15 0"></a-cone>
          <a-text value="PORT" align="center" position="0 0.4 0" scale="0.4 0.4 0.4" color="#2196f3" look-at="[camera]"></a-text>
        </a-entity>

      </a-entity> </a-entity> <a-entity camera look-controls="enabled: true" position="0 1.6 0">
      <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: white; shader: flat" visible="false"></a-entity>
    </a-entity>

  </a-scene>

  <script>
    // === 邏輯控制 ===
    
    // 1. 綁定物件
    const flatMap = document.querySelector('#flat-map');
    const arMap3D = document.querySelector('#ar-map-3d');
    const hintBar = document.querySelector('#hint-bar');
    const infoPanel = document.querySelector('#info-panel');
    const panelTitle = document.querySelector('#panel-title');
    const panelContent = document.querySelector('#panel-content');
    
    // 2. 定義真實經濟數據 (Mock Data)
    const db = {
      'samsung': {
        title: 'SAMSUNG (Bac Ninh)',
        html: `
          <div class="data-row"><span class="data-label">投資金額:</span> <span class="data-val">$190 億美元</span></div>
          <div class="data-row"><span class="data-label">員工人數:</span> <span class="data-val">約 40,000 人</span></div>
          <div class="data-row"><span class="data-label">主要產品:</span> <span class="data-val">Galaxy S/Z 系列</span></div>
          <div class="data-row"><span class="data-label">經濟貢獻:</span> <span class="data-val">佔越南出口 18%</span></div>
          <p style="font-size:12px; color:#aaa; margin-top:10px;">全球約 50% 的三星手機在此製造，是北越經濟最重要的支柱。</p>
        `
      },
      'apple': {
        title: 'APPLE SUPPLY CHAIN',
        html: `
          <div class="data-row"><span class="data-label">合作廠商:</span> <span class="data-val">Luxshare, Foxconn</span></div>
          <div class="data-row"><span class="data-label">地點:</span> <span class="data-val">Bac Giang (北江省)</span></div>
          <div class="data-row"><span class="data-label">主要產品:</span> <span class="data-val">iPad, Apple Watch</span></div>
          <div class="data-row"><span class="data-label">戰略意義:</span> <span class="data-val">供應鏈去風險化</span></div>
          <p style="font-size:12px; color:#aaa; margin-top:10px;">Apple 正將 iPad 與 Mac 產線逐步移入此區，以執行 China Plus One 策略。</p>
        `
      },
      'port': {
        title: 'HAI PHONG PORT',
        html: `
          <div class="data-row"><span class="data-label">類型:</span> <span class="data-val">深水國際港</span></div>
          <div class="data-row"><span class="data-label">吞吐量:</span> <span class="data-val">9,200 萬噸/年</span></div>
          <div class="data-row"><span class="data-label">連結:</span> <span class="data-val">直通歐美市場</span></div>
          <p style="font-size:12px; color:#aaa; margin-top:10px;">北越製造業的出口咽喉，從北寧工廠至此僅需 1.5 小時車程。</p>
        `
      }
    };

    // 3. 互動：點擊 2D 地圖 -> 變身 3D
    flatMap.addEventListener('click', function() {
      // 隱藏 2D 提示
      hintBar.innerHTML = "點擊地圖上的標記 (Pins) 查看詳細經濟數據";
      
      // 動畫：2D 地圖縮小消失
      flatMap.setAttribute('animation', 'property: scale; to: 0 0 0; dur: 500; easing: easeInBack');
      
      // 動畫：3D 地圖彈出
      setTimeout(() => {
        flatMap.setAttribute('visible', 'false');
        arMap3D.setAttribute('visible', 'true');
        arMap3D.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutElastic');
      }, 500);
    });

    // 4. 互動：點擊 3D 標記
    const markers = document.querySelectorAll('.marker-pin');
    markers.forEach(marker => {
      marker.addEventListener('click', function() {
        const type = this.getAttribute('data-type');
        const data = db[type];

        // 更新 UI 內容
        panelTitle.innerText = data.title;
        panelContent.innerHTML = data.html;

        // 顯示面板
        infoPanel.classList.add('active');

        // 點擊回饋：稍微放大一下 Pin
        this.object3D.scale.set(1.2, 1.2, 1.2);
        setTimeout(() => {
          this.object3D.scale.set(1, 1, 1);
        }, 200);
      });
    });

    // 5. 點擊背景關閉面板
    document.querySelector('a-sky').addEventListener('click', () => {
       infoPanel.classList.remove('active');
    });

    // 簡單的 look-at component 確保文字面向使用者
    AFRAME.registerComponent('look-at', {
      schema: { type: 'selector' },
      init: function () {},
      tick: function () {
        this.el.object3D.lookAt(this.el.sceneEl.camera.el.object3D.position);
      }
    });
  </script>
</body>
</html>
