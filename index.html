<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Ultimate War Room</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  
  <style>
    /* 引入現代字體 */
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Inter:wght@300;400&display=swap');
    
    body { margin: 0; overflow: hidden; background: #111; font-family: 'Inter', sans-serif; }

    /* === UI 層 === */
    #ui-layer {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* 讓點擊穿透 */
      z-index: 999;
      display: flex; flex-direction: column; justify-content: space-between;
    }

    /* 頂部標題 */
    .header-bar {
      padding: 20px 30px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      border-bottom: 1px solid rgba(0, 255, 204, 0.3);
      display: flex; justify-content: space-between; align-items: center;
    }
    .title { font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: bold; color: #00ffcc; letter-spacing: 2px; text-shadow: 0 0 10px rgba(0,255,204,0.5); }
    .status { font-family: 'Rajdhani'; color: white; border: 1px solid #555; padding: 5px 15px; border-radius: 20px; font-size: 14px; background: rgba(0,0,0,0.5); }

    /* 右側資料面板 (互動跳出) */
    #info-panel {
      position: absolute; top: 15%; right: 30px;
      width: 340px;
      background: rgba(15, 23, 30, 0.95);
      border: 1px solid #333;
      border-left: 4px solid #00ffcc;
      box-shadow: -10px 10px 40px rgba(0,0,0,0.8);
      padding: 25px;
      color: white;
      transform: translateX(130%); /* 隱藏 */
      transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      pointer-events: auto; /* 允許點擊 */
      border-radius: 8px;
    }
    #info-panel.active { transform: translateX(0); }

    .panel-head { font-family: 'Rajdhani'; font-size: 24px; color: #00ffcc; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; }
    .panel-body { font-size: 14px; line-height: 1.6; color: #ccc; }
    .stat-tag { display: inline-block; background: rgba(0, 255, 204, 0.15); color: #00ffcc; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 8px; font-weight: bold; }

    /* 底部提示 */
    .footer { text-align: center; padding: 15px; background: linear-gradient(0deg, rgba(0,0,0,0.9), transparent); color: #888; font-size: 13px; font-family: 'Rajdhani'; letter-spacing: 1px; }

    /* 錯誤提示 */
    #error-box { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(200,0,0,0.9); padding:30px; color:white; display:none; pointer-events:auto; text-align:center; border-radius:8px; }
  </style>
</head>

<body>
  
  <div id="error-box">
    <h3>MISSING MAP.JPG</h3>
    <p>請確認資料夾內有 <b>map.jpg</b></p>
    <button onclick="location.reload()" style="padding:10px 20px; cursor:pointer;">RETRY</button>
  </div>

  <div id="ui-layer">
    <div class="header-bar">
      <div class="title">VILL STRATEGY ROOM</div>
      <div class="status">● SIMULATION LIVE</div>
    </div>

    <div id="info-panel">
      <div class="panel-head" id="p-title">Data Node</div>
      <div class="panel-body" id="p-content">Waiting for input...</div>
    </div>

    <div class="footer">
      [ 左鍵 ] 旋轉視角 &nbsp;•&nbsp; [ 滾輪 ] 縮放 &nbsp;•&nbsp; [ 右鍵 ] 平移 &nbsp;•&nbsp; [ 點擊 ] 互動
    </div>
  </div>

  <a-scene 
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true; exposure: 1.2;" 
    cursor="rayOrigin: mouse" 
    raycaster="objects: .clickable">

    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="document.getElementById('error-box').style.display='block'">
      <canvas id="floorCanvas" width="512" height="512"></canvas>
    </a-assets>

    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" material="src: #floorCanvas; roughness: 0.2; metalness: 0.3; color: #444"></a-plane>
    <a-plane position="0 6 0" rotation="90 0 0" width="30" height="30" color="#222"></a-plane>
    <a-box position="0 3 -10" width="30" height="6" depth="0.5" color="#333"></a-box> <a-box position="-10 3 0" width="0.5" height="6" depth="30" color="#2a2a2a"></a-box> <a-box position="10 3 0" width="0.5" height="6" depth="30" color="#2a2a2a"></a-box> <a-box position="0 3 10" width="30" height="6" depth="0.5" color="#333"></a-box> <a-box position="0 4 -9.7" width="20" height="0.1" depth="0.1" color="#00ffcc" material="emissive: #00ffcc; emissiveIntensity: 2"></a-box>
    <a-box position="-9.7 4 0" width="0.1" height="0.1" depth="20" color="#00ffcc" material="emissive: #00ffcc; emissiveIntensity: 2"></a-box>

    <a-light type="ambient" intensity="0.4" color="#ffffff"></a-light>
    <a-light type="spot" position="0 8 0" target="#table-group" intensity="1.5" angle="45" penumbra="0.5" castShadow="true"></a-light>
    <a-light type="point" position="5 3 -5" intensity="0.5" color="#0088ff"></a-light>

    <a-entity id="table-group" position="0 0 0">
      <a-cylinder position="0 0.8 0" radius="2" height="0.05" color="#111" material="roughness: 0.1; metalness: 0.5"></a-cylinder>
      <a-torus position="0 0.8 0" rotation="90 0 0" radius="2" radius-tubular="0.02" color="#00ffcc" material="emissive: #00ffcc; emissiveIntensity: 1"></a-torus>
      <a-cylinder position="0 0.4 0" radius="0.6" height="0.8" color="#222" material="metalness: 0.6"></a-cylinder>
      <a-cylinder position="0 0.02 0" radius="1.2" height="0.05" color="#111"></a-cylinder>
    </a-entity>

    <a-entity id="flat-map" position="0 0.84 0.5" rotation="-90 0 0">
      <a-plane width="1.2" height="1.6" color="#fff"></a-plane>
      <a-image src="#map-tex" width="1.1" height="1.5" position="0 0 0.01"></a-image>
      <a-plane width="1.2" height="1.6" position="0 0 0.02" color="#00ffcc" opacity="0" class="clickable"
               animation__hover="property: opacity; from: 0; to: 0.3; dur: 200; startEvents: mouseenter; pauseEvents: mouseleave"
               onclick="activateHologram()">
      </a-plane>
      <a-text value="CLICK TO ACTIVATE" align="center" color="#00ffcc" position="0 0 0.05" scale="0.8 0.8 0.8"></a-text>
    </a-entity>

    <a-entity id="hologram-group" position="0 0.85 0" visible="false" scale="0 0 0">
      
      <a-cylinder position="0 0 0" radius="1.8" height="0.02" color="#00ffcc" material="opacity: 0.1; transparent: true"></a-cylinder>
      <a-ring position="0 0.01 0" rotation="-90 0 0" radius-inner="1.7" radius-outer="1.8" color="#00ffcc"></a-ring>

      <a-entity position="0 0.3 0" rotation="-90 0 0">
        <a-image src="#map-tex" width="2.4" height="2.4" material="opacity: 0.95"></a-image>
        
        <a-plane width="2.4" height="0.05" color="#00ffcc" opacity="0.4" position="0 -1 0.05">
           <a-animation attribute="position" from="0 -1.2 0.05" to="0 1.2 0.05" dur="3000" dir="alternate" repeat="indefinite" easing="linear"></a-animation>
        </a-plane>

        <a-entity position="-0.3 0.6 0.1" class="clickable pin" data-id="samsung">
           <a-sphere radius="0.06" color="#ff0055" position="0 0 0.1"></a-sphere>
           <a-cone radius-bottom="0.01" radius-top="0.06" height="0.2" color="#ff0055" rotation="90 0 0"></a-cone>
           <a-ring radius-inner="0.06" radius-outer="0.08" color="#ff0055">
             <a-animation attribute="scale" to="2 2 1" dur="1500" repeat="indefinite"></a-animation>
             <a-animation attribute="material.opacity" from="1" to="0" dur="1500" repeat="indefinite"></a-animation>
           </a-ring>
           <a-text value="SAMSUNG" align="center" position="0 -0.15 0.3" scale="0.6 0.6 0.6" color="white"></a-text>
        </a-entity>

        <a-entity position="0.3 0.1 0.1" class="clickable pin" data-id="nvidia">
           <a-sphere radius="0.06" color="#76b900" position="0 0 0.1"></a-sphere>
           <a-cone radius-bottom="0.01" radius-top="0.06" height="0.2" color="#76b900" rotation="90 0 0"></a-cone>
           <a-text value="NVIDIA" align="center" position="0 -0.15 0.3" scale="0.6 0.6 0.6" color="white"></a-text>
        </a-entity>

        <a-entity position="0.1 -0.5 0.1" class="clickable pin" data-id="intel">
           <a-sphere radius="0.06" color="#0071c5" position="0 0 0.1"></a-sphere>
           <a-cone radius-bottom="0.01" radius-top="0.06" height="0.2" color="#0071c5" rotation="90 0 0"></a-cone>
           <a-text value="INTEL" align="center" position="0 -0.15 0.3" scale="0.6 0.6 0.6" color="white"></a-text>
        </a-entity>

      </a-entity>
    </a-entity>

    <a-entity id="camera-rig" position="0 0 0" rotation="0 0 0">
      <a-camera 
        position="0 3 4.5" 
        look-controls="enabled: true; pointerLockEnabled: false" 
        wasd-controls="enabled: true; acceleration: 50">
      </a-camera>
    </a-entity>

  </a-scene>

  <script>
    // 1. 動態生成精緻地板紋理 (解決背景黑屏問題)
    const canvas = document.getElementById('floorCanvas');
    const ctx = canvas.getContext('2d');
    // 底色
    ctx.fillStyle = '#222';
    ctx.fillRect(0,0,512,512);
    // 木紋線條
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    for(let i=0; i<512; i+=40) {
        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(512, i); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 512); ctx.stroke();
    }

    // 2. 互動邏輯
    const flatMap = document.getElementById('flat-map');
    const hologram = document.getElementById('hologram-group');
    const panel = document.getElementById('info-panel');
    const pTitle = document.getElementById('p-title');
    const pContent = document.getElementById('p-content');

    // 點擊平面地圖 -> 開啟全息圖
    window.activateHologram = function() {
      // 隱藏平面
      flatMap.setAttribute('visible', 'false');
      // 顯示全息
      hologram.setAttribute('visible', 'true');
      // 動畫：彈出
      hologram.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutBack');
    };

    // 資料庫
    const db = {
      samsung: {
        title: 'SAMSUNG<br><span class="stat-tag">NORTH CLUSTER</span>',
        html: '<b>Location:</b> Bac Ninh<br><b>Investment:</b> $19.2 Billion<br><b>Focus:</b> Mobile Assembly & R&D<br><br>全球最大的三星手機製造基地，位於北越電子供應鏈核心。'
      },
      nvidia: {
        title: 'NVIDIA<br><span class="stat-tag">CENTRAL HUB</span>',
        html: '<b>Location:</b> Da Nang<br><b>Partner:</b> FPT / Viettel<br><b>Focus:</b> AI Chip Design<br><br>正與越南政府合作建立 AI 工廠，利用中部大學人才發展晶片設計。'
      },
      intel: {
        title: 'INTEL<br><span class="stat-tag">SOUTH CLUSTER</span>',
        html: '<b>Location:</b> Ho Chi Minh (SHTP)<br><b>Facility:</b> IPV (ATM)<br><b>Focus:</b> Packaging & Test<br><br>Intel 全球最大的封測廠，擁有最完善的基礎設施與物流系統。'
      }
    };

    // 綁定 Pin 點擊事件
    document.querySelectorAll('.pin').forEach(pin => {
      // 滑鼠移入變大
      pin.addEventListener('mouseenter', function() {
        this.object3D.scale.set(1.3, 1.3, 1.3);
      });
      pin.addEventListener('mouseleave', function() {
        this.object3D.scale.set(1, 1, 1);
      });
      // 點擊顯示資料
      pin.addEventListener('click', function(evt) {
        // 阻止事件冒泡 (重要!)
        evt.stopPropagation();
        
        const id = this.getAttribute('data-id');
        const data = db[id];
        
        pTitle.innerHTML = data.title;
        pContent.innerHTML = data.html;
        panel.classList.add('active');
      });
    });

    // 點擊背景關閉視窗
    document.querySelector('a-scene').addEventListener('click', function(evt) {
      if (!evt.target.classList.contains('clickable')) {
        panel.classList.remove('active');
      }
    });
  </script>
</body>
</html>
