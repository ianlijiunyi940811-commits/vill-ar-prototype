<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Realistic Classroom (V20)</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; background-color: #000; }

    /* UI å±¤ */
    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; display: flex; flex-direction: column; justify-content: space-between; }
    .header { background: rgba(20, 30, 40, 0.95); border-bottom: 3px solid #00d2ff; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; pointer-events: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
    .title { color: #00d2ff; font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: bold; letter-spacing: 2px; }
    .subtitle { color: #fff; font-size: 14px; margin-left: 15px; opacity: 0.8; }
    
    /* ç²¾ç·»åŒ–çš„è³‡æ–™é¢æ¿ */
    #info-panel { 
      position: absolute; top: 120px; right: 30px; width: 380px; 
      background: rgba(255, 255, 255, 0.95); /* æ”¹ç”¨äº®è‰²èƒŒæ™¯ï¼Œåƒç´™å¼µ */
      border-left: 6px solid #00d2ff; 
      border-radius: 4px; padding: 30px; 
      color: #333; /* æ·±è‰²æ–‡å­— */
      transform: translateX(130%); transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); 
      pointer-events: auto; 
      box-shadow: -10px 10px 50px rgba(0,0,0,0.3); 
    }
    #info-panel.active { transform: translateX(0); }
    
    .panel-h { color: #0056b3; font-size: 24px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; font-family: 'Rajdhani'; }
    .panel-b { font-size: 15px; line-height: 1.8; color: #444; }
    
    ul { padding-left: 20px; margin: 0; }
    li { margin-bottom: 8px; }
    strong { color: #000; font-weight: 700; }

    .tag { display: inline-block; background: #e3f2fd; color: #0277bd; padding: 4px 10px; border-radius: 4px; font-size: 12px; margin-bottom: 15px; font-weight: bold; border: 1px solid #bbdefb; }
    .close-btn { position: absolute; top: 15px; right: 15px; color: #999; cursor: pointer; font-size: 20px; transition: 0.2s; } 
    .close-btn:hover { color: #333; transform: rotate(90deg); }
    .controls-hint { text-align: center; padding: 15px; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); color: #ccc; font-size: 13px; text-shadow: 1px 1px 2px black; }
  </style>

  <script>
    // === Smart Label (ä¿æŒæ–‡å­—é¢å‘è¢å¹•) ===
    AFRAME.registerComponent('smart-label', {
      tick: function () {
        var cameraEl = this.el.sceneEl.camera.el;
        if (!cameraEl) return;
        this.el.object3D.quaternion.copy(cameraEl.object3D.quaternion);
      }
    });
  </script>
</head>

<body>

  <div id="ui-layer">
    <div class="header">
      <div><span class="title">VILL SYSTEM</span><span class="subtitle">Module: North Vietnam Supply Chain</span></div>
      <div style="background:#00d2ff; color:black; font-size:12px; padding:4px 10px; border-radius:4px; font-weight:bold;">LIVE CLASSROOM</div>
    </div>
    
    <div id="info-panel">
      <div class="close-btn" onclick="closePanel()">âœ•</div>
      <div class="panel-h" id="p-title">Data Node</div>
      <div class="panel-b" id="p-content">...</div>
    </div>
    
    <div class="controls-hint">ğŸ–±ï¸ å·¦éµæ‹–æ›³: æ—‹è½‰ | ğŸ–±ï¸ æ»¾è¼ª: ç¸®æ”¾ | ğŸ–±ï¸ å³éµæ‹–æ›³: å¹³ç§» | ğŸ‘† è«‹é»æ“Šåœ°åœ–ä¸Šçš„æ¨™è¨˜</div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png'">
      <canvas id="floor-tex" width="512" height="512"></canvas>
      <canvas id="wood-tex" width="512" height="512"></canvas>
      <canvas id="wall-tex" width="512" height="512"></canvas>
    </a-assets>

    <a-sky color="#87CEEB"></a-sky> <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" material="src: #floor-tex; roughness: 0.8; repeat: 4 4"></a-plane>
    <a-plane position="0 5 0" rotation="90 0 0" width="20" height="20" color="#eee"></a-plane>

    <a-box position="0 2.5 -6" width="20" height="5" depth="0.2" material="src: #wall-tex; color: #f0f0f0"></a-box>
    <a-plane position="0 2.5 -5.8" width="6" height="2" color="white" material="roughness: 0.2"></a-plane>
    <a-box position="0 1.4 -5.75" width="4" height="0.05" depth="0.1" color="#888"></a-box> <a-box position="6 2.5 0" width="0.2" height="5" depth="20" material="src: #wall-tex; color: #f0f0f0"></a-box>

    <a-box position="-6 4 0" width="0.2" height="2" depth="20" material="src: #wall-tex; color: #f0f0f0"></a-box>
    <a-box position="-6 1 0" width="0.2" height="2" depth="20" material="src: #wall-tex; color: #f0f0f0"></a-box>
    <a-box position="-6 2.5 5" width="0.2" height="1" depth="10" material="src: #wall-tex; color: #f0f0f0"></a-box>
    <a-box position="-6 2.5 -5" width="0.2" height="1" depth="10" material="src: #wall-tex; color: #f0f0f0"></a-box>
    
    <a-box position="-6 2.5 0" width="0.1" height="0.1" depth="4" color="#ddd"></a-box>
    <a-box position="-6 2.5 0" width="0.1" height="1.5" depth="0.1" color="#ddd"></a-box>


    <a-light type="ambient" intensity="0.6" color="#fff"></a-light>
    <a-light type="directional" position="-10 5 2" intensity="1.5" castShadow="true" color="#ffd"></a-light>
    <a-light type="point" position="0 4 0" intensity="0.5" distance="10" decay="2"></a-light>
    <a-box position="0 4.9 0" width="0.2" height="0.1" depth="1.2" color="#fff" material="emissive: #fff; emissiveIntensity: 1"></a-box>


    <a-entity id="table-group" position="0 0 0">
      <a-box position="0 0.8 0" width="2.2" height="0.1" depth="3.2" material="src: #wood-tex; roughness: 0.3; metalness: 0.1"></a-box>
      
      <a-cylinder position="-0.8 0.4 -1.2" radius="0.05" height="0.8" color="#222"></a-cylinder>
      <a-cylinder position="0.8 0.4 -1.2" radius="0.05" height="0.8" color="#222"></a-cylinder>
      <a-cylinder position="-0.8 0.4 1.2" radius="0.05" height="0.8" color="#222"></a-cylinder>
      <a-cylinder position="0.8 0.4 1.2" radius="0.05" height="0.8" color="#222"></a-cylinder>
      
      <a-image src="#map-tex" width="1.8" height="2.6" position="0 0.86 0" rotation="-90 0 0" material="shader: standard; roughness: 0.8"></a-image>
      
      <a-plane width="1.8" height="0.05" rotation="-90 0 0" color="#00d2ff" opacity="0.2" position="0 0.87 0">
         <a-animation attribute="position" from="0 0.87 -1" to="0 0.87 1" dur="4000" dir="alternate" repeat="indefinite"></a-animation>
      </a-plane>


      <a-entity position="0.05 0.86 -0.65" class="pin" data-id="samsung">
        <a-box class="clickable" visible="false" width="0.4" height="0.8" depth="0.4" position="0 0.2 0"></a-box>
        
        <a-sphere radius="0.06" color="#ff0055" position="0 0.15 0">
           <a-animation attribute="scale" to="1.2 1.2 1.2" dur="800" dir="alternate" repeat="indefinite"></a-animation>
        </a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ff0055" position="0 0.075 0"></a-cone>
        
        <a-entity position="0 0.45 0" smart-label>
           <a-text value="SAMSUNG" align="center" color="black" width="4" position="0.005 -0.005 -0.01" scale="0.5 0.5 0.5"></a-text>
           <a-text value="SAMSUNG" align="center" color="#fff" width="4" position="0 0 0" scale="0.5 0.5 0.5"></a-text>
        </a-entity>
      </a-entity>


      <a-entity position="-0.05 0.86 -0.48" class="pin" data-id="apple">
        <a-box class="clickable" visible="false" width="0.4" height="0.8" depth="0.4" position="0 0.2 0"></a-box>
        
        <a-sphere radius="0.06" color="#ffffff" position="0 0.15 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ffffff" position="0 0.075 0"></a-cone>
        
        <a-entity position="0 0.45 0" smart-label>
           <a-text value="APPLE" align="center" color="black" width="4" position="0.005 -0.005 -0.01" scale="0.5 0.5 0.5"></a-text>
           <a-text value="APPLE" align="center" color="#fff" width="4" position="0 0 0" scale="0.5 0.5 0.5"></a-text>
        </a-entity>
      </a-entity>

    </a-entity> <a-entity camera look-controls="enabled: false" orbit-controls="target: 0 0.8 0; minDistance: 0.1; maxDistance: 10; initialPosition: 0 2 3.5; rotateSpeed: 0.5; zoomSpeed: 2.0; enableZoom: true; enablePan: true; screenSpacePanning: true;"></a-entity>
  </a-scene>

  <script>
    // === æè³ªç”Ÿæˆå™¨ (Procedural Textures) ===
    
    // 1. æœ¨ç´‹ (æ¡Œå­)
    const c1 = document.getElementById('wood-tex').getContext('2d');
    c1.fillStyle = '#5d4037'; c1.fillRect(0,0,512,512);
    c1.strokeStyle = '#3e2723'; c1.lineWidth = 3;
    for(let i=0;i<60;i++){c1.beginPath();c1.moveTo(0,Math.random()*512);c1.bezierCurveTo(150,Math.random()*512,350,Math.random()*512,512,Math.random()*512);c1.stroke();}
    
    // 2. ç£ç£š (åœ°æ¿)
    const c2 = document.getElementById('floor-tex').getContext('2d');
    c2.fillStyle = '#e0e0e0'; c2.fillRect(0,0,512,512);
    c2.strokeStyle = '#bdbdbd'; c2.lineWidth = 4;
    c2.strokeRect(0,0,512,512); // é‚Šæ¡†
    c2.fillStyle = '#f5f5f5'; c2.fillRect(10,10,230,230); c2.fillRect(260,10,230,230); // æ ¼å­
    c2.fillRect(10,260,230,230); c2.fillRect(260,260,230,230);

    // 3. ç‰†å£ (æ°´æ³¥è³ªæ„Ÿ)
    const c3 = document.getElementById('wall-tex').getContext('2d');
    c3.fillStyle = '#fcfcfc'; c3.fillRect(0,0,512,512);
    for(let i=0;i<5000;i++){
        c3.fillStyle = Math.random()>0.5 ? '#eee' : '#fff';
        c3.fillRect(Math.random()*512, Math.random()*512, 2, 2);
    }

    // === äº’å‹•é‚è¼¯ ===
    const panel = document.getElementById('info-panel');
    const pTitle = document.getElementById('p-title');
    const pContent = document.getElementById('p-content');

    window.closePanel = function() { panel.classList.remove('active'); };

    const db = {
      samsung: { 
        title: "SAMSUNG ELECTRONICS", 
        body: `
          <span class='tag'>LOCATION: BAC NINH (åŒ—å¯§çœ)</span>
          <p><strong>ç‚ºä»€éº¼é¸æ“‡é€™è£¡ï¼Ÿ (Why Here?)</strong></p>
          <ul>
            <li><strong>1. ä¾›æ‡‰éˆè¿‘é„°æ•ˆæ‡‰ï¼š</strong><br>ç·Šé„°ä¸­åœ‹å»£è¥¿é‚Šå¢ƒï¼Œé›¶çµ„ä»¶é™¸é‹åƒ…éœ€ 12 å°æ™‚ã€‚</li>
            <li><strong>2. å…¨çƒç‰©æµæ¨ç´ï¼š</strong><br>è·é›¢å…§æ’åœ‹éš›æ©Ÿå ´ (Noi Bai) åƒ… 40 åˆ†é˜è»Šç¨‹ã€‚</li>
            <li><strong>3. æ”¿ç­–æ”¯æŒï¼š</strong><br>äº«æœ‰ã€Œå››å…ä¹æ¸›åŠã€ç¨…å‹™å„ªæƒ ã€‚</li>
          </ul>
        ` 
      },
      apple: { 
        title: "APPLE / FOXCONN", 
        body: `
          <span class='tag'>LOCATION: BAC GIANG (åŒ—æ±Ÿçœ)</span>
          <p><strong>ç‚ºä»€éº¼é¸æ“‡é€™è£¡ï¼Ÿ (Why Here?)</strong></p>
          <ul>
            <li><strong>1. ä¸­åœ‹åŠ ä¸€ç­–ç•¥ (China Plus One)ï¼š</strong><br>åˆ†æ•£åœ°ç·£æ”¿æ²»é¢¨éšªï¼Œå»ºç«‹å‚™æ´ç”¢ç·šã€‚</li>
            <li><strong>2. ç”¢æ¥­èšè½æ•ˆæ‡‰ï¼š</strong><br>åˆ©ç”¨é„°è¿‘ä¸‰æ˜Ÿç”Ÿæ…‹ç³»ï¼Œå¿«é€Ÿè¤‡è£½çµ„è£é‡èƒ½ã€‚</li>
            <li><strong>3. å……è¶³å‹å‹•åŠ›ï¼š</strong><br>æ“æœ‰å¤§é‡å¹´è¼•ä¸”è¨“ç·´æœ‰ç´ çš„æŠ€è¡“å·¥äººç¾¤é«”ã€‚</li>
          </ul>
        ` 
      }
    };

    document.querySelectorAll('.clickable').forEach(el => {
      el.addEventListener('click', function(e) {
        e.stopPropagation(); 
        const parentPin = this.closest('.pin');
        if (parentPin) {
          const id = parentPin.getAttribute('data-id');
          const data = db[id];
          if (data) {
            pTitle.innerHTML = data.title; 
            pContent.innerHTML = data.body; 
            panel.classList.add('active');
          }
        }
      });
      el.addEventListener('mouseenter', function() { 
        const parent = this.closest('.pin');
        if(parent) parent.object3D.scale.set(1.3, 1.3, 1.3); 
        document.body.style.cursor = 'pointer'; 
      });
      el.addEventListener('mouseleave', function() { 
        const parent = this.closest('.pin');
        if(parent) parent.object3D.scale.set(1, 1, 1); 
        document.body.style.cursor = 'default'; 
      });
    });
  </script>
</body>
</html>
