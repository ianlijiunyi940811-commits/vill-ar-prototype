<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: V34 Pin-Aligned Spatial UI</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; background-color: #000; }

    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; display: flex; flex-direction: column; justify-content: space-between; }
    .header { background: rgba(20, 30, 40, 0.9); border-bottom: 3px solid #00d2ff; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; pointer-events: auto; }
    .title { color: #00d2ff; font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: bold; letter-spacing: 2px; }
    .subtitle { color: #fff; font-size: 14px; margin-left: 15px; opacity: 0.8; }
    .controls-hint { text-align: center; padding: 15px; background: linear-gradient(0deg, rgba(0,0,0,0.8), transparent); color: #ccc; font-size: 13px; text-shadow: 1px 1px 2px black; }
  </style>

  <script>
    AFRAME.registerComponent('smart-label', {
      tick: function () {
        var cameraEl = this.el.sceneEl.camera.el;
        if (!cameraEl) return;
        this.el.object3D.quaternion.copy(cameraEl.object3D.quaternion);
      }
    });
  </script>
</head>

<body>

  <div id="ui-layer">
    <div class="header">
      <div><span class="title">VILL SYSTEM</span><span class="subtitle">Module: North Vietnam Supply Chain</span></div>
      <div style="background:#00d2ff; color:black; font-size:12px; padding:4px 10px; border-radius:4px; font-weight:bold;">SPATIAL MODE</div>
    </div>
    <div class="controls-hint">ğŸ–±ï¸ å·¦éµæ‹–æ›³: æ—‹è½‰ | ğŸ–±ï¸ æ»¾è¼ª: ç¸®æ”¾ | ğŸ–±ï¸ å³éµæ‹–æ›³: å¹³ç§» | ğŸ‘† é»æ“Šæ¨™è¨˜æŸ¥çœ‹åˆ†æ</div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png'">
      <canvas id="floor-tex" width="512" height="512"></canvas>
      <canvas id="wood-tex" width="512" height="512"></canvas>
      <canvas id="wall-tex" width="512" height="512"></canvas>
      <canvas id="ui-bg-tex" width="512" height="512"></canvas>
      <canvas id="ui-header-tex" width="512" height="100"></canvas>
    </a-assets>

    <a-sky color="#87CEEB"></a-sky> 
    <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" material="src: #floor-tex; roughness: 0.8; repeat: 4 4"></a-plane>
    <a-plane position="0 5 0" rotation="90 0 0" width="20" height="20" color="#fdf5e6"></a-plane>
    <a-box position="0 2.5 -6" width="20" height="5" depth="0.2" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="6 2.5 0" width="0.2" height="5" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 4 0" width="0.2" height="2" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 1 0" width="0.2" height="2" depth="20" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 2.5 5" width="0.2" height="1" depth="10" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="-6 2.5 -5" width="0.2" height="1" depth="10" color="#fdf5e6" material="src:#wall-tex"></a-box>
    <a-box position="0 2.5 -5.8" width="6" height="2" depth="0.1" color="#1b5e20" material="roughness: 0.9"></a-box>
    <a-box position="0 1.4 -5.75" width="4" height="0.05" depth="0.15" color="#5d4037"></a-box>

    <a-light type="ambient" intensity="0.7" color="#fff"></a-light>
    <a-light type="directional" position="-10 5 2" intensity="1.2" castShadow="true" color="#ffd"></a-light>
    <a-light type="spot" position="0 6 0" target="#table" intensity="0.8" penumbra="0.5"></a-light>

    <a-entity id="table" position="0 0 0">
      <a-cylinder position="0 0.8 0" radius="2.2" height="0.1" material="src: #wood-tex; color: #5d4037; roughness: 0.4"></a-cylinder>
      <a-cylinder position="0 0.4 0" radius="0.3" height="0.8" color="#333"></a-cylinder>
      <a-cylinder position="0 0.02 0" radius="1.2" height="0.05" color="#222"></a-cylinder>
    </a-entity>

    <a-entity id="step1-flat" position="0 0.86 0" rotation="-90 0 0">
      <a-plane width="1.4" height="2" color="#fff" class="clickable" onclick="activateHologram()">
        <a-image src="#map-tex" width="1.3" height="1.9" position="0 0 0.01" material="color: #666"></a-image>
        <a-text value="CLICK TO ACTIVATE MAP" align="center" position="0 0 0.05" color="white" scale="0.8 0.8 0.8"></a-text>
        <a-plane width="1.4" height="2" position="0 0 0.02" visible="false"></a-plane>
      </a-plane>
    </a-entity>

    <a-entity id="step2-ar" position="0 1.2 0" visible="false" scale="0.1 0.1 0.1">
      <a-image src="#map-tex" width="1.8" height="2.6" rotation="-90 0 0" material="shader: flat"></a-image>
      <a-plane width="1.8" height="0.05" rotation="-90 0 0" color="#00d2ff" opacity="0.3" position="0 0.05 0">
         <a-animation attribute="position" from="0 0.05 -1" to="0 0.05 1" dur="2500" dir="alternate" repeat="indefinite"></a-animation>
      </a-plane>

      <a-entity position="0.05 0.1 -0.65" class="pin">
        <a-box class="clickable" width="0.6" height="1.0" depth="0.6" position="0 0.2 0" 
               material="opacity: 0; transparent: true; depthWrite: false" 
               onclick="toggleCard('card-samsung')"></a-box>
        
        <a-sphere radius="0.06" color="#ff0055" position="0 0.15 0">
           <a-animation attribute="scale" to="1.2 1.2 1.2" dur="800" dir="alternate" repeat="indefinite"></a-animation>
        </a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ff0055" position="0 0.075 0"></a-cone>
        <a-entity position="0 0.45 0" smart-label>
           <a-text value="SAMSUNG" align="center" color="black" width="4" position="0.005 -0.005 -0.01" scale="0.5 0.5 0.5"></a-text>
           <a-text value="SAMSUNG" align="center" color="#fff" width="4" position="0 0 0" scale="0.5 0.5 0.5"></a-text>
        </a-entity>

        <a-entity id="card-samsung" position="0 1.8 0" visible="false" scale="0 0 0" smart-label>
          <a-plane width="2.8" height="0.35" material="src: #ui-header-tex; transparent: true" color="#007bff" position="0 1.2 0.02"></a-plane>
          <a-plane width="2.8" height="2.7" material="src: #ui-bg-tex; transparent: true; opacity: 0.98" position="0 0 0"></a-plane>
          <a-text value="SAMSUNG (Bac Ninh Cluster)" color="#fff" align="center" position="0 1.2 0.04" width="3.5"></a-text>
          
          <a-text value="(A) Supply Chain Proximity:\nClose to China border. Parts delivered in 12hrs.\n\n(B) Risk Diversification:\nReduce reliance on single production base (China).\n\n(C) Labor & Cost Advantage:\nAccess to large-scale, cost-competitive workforce.\n\n(D) Gov Incentives:\nSpecific tax breaks and land support in Bac Ninh.\n\n(E) China+1 Strategy:\nFoxconn expanding here for resilience." 
                  color="#e0f7fa" align="left" anchor="center" baseline="top" position="0 0.95 0.04" width="2.5" wrapCount="62" lineHeight="50"></a-text>
          
          <a-text value="[ CLICK TO CLOSE ]" color="#4dd0e1" align="center" position="0 -1.15 0.04" width="2.2"></a-text>
          <a-plane class="clickable" width="2.8" height="2.7" position="0 0 0.05" visible="false" onclick="toggleCard('card-samsung')"></a-plane>
        </a-entity>
      </a-entity>

      <a-entity position="-0.05 0.1 -0.48" class="pin">
        <a-box class="clickable" width="0.6" height="1.0" depth="0.6" position="0 0.2 0" 
               material="opacity: 0; transparent: true; depthWrite: false" 
               onclick="toggleCard('card-apple')"></a-box>
        <a-sphere radius="0.06" color="#ffffff" position="0 0.15 0">
           <a-animation attribute="scale" to="1.2 1.2 1.2" dur="800" dir="alternate" repeat="indefinite"></a-animation>
        </a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.06" height="0.15" color="#ffffff" position="0 0.075 0"></a-cone>
        <a-entity position="0 0.45 0" smart-label>
           <a-text value="APPLE" align="center" color="black" width="4" position="0.005 -0.005 -0.01" scale="0.5 0.5 0.5"></a-text>
           <a-text value="APPLE" align="center" color="#fff" width="4" position="0 0 0" scale="0.5 0.5 0.5"></a-text>
        </a-entity>

        <a-entity id="card-apple" position="0 1.8 0" visible="false" scale="0 0 0" smart-label>
          <a-plane width="2.8" height="0.35" material="src: #ui-header-tex; transparent: true" color="#95a5a6" position="0 1.2 0.02"></a-plane>
          <a-plane width="2.8" height="2.7" material="src: #ui-bg-tex; transparent: true; opacity: 0.98" position="0 0 0"></a-plane>
          <a-text value="APPLE Suppliers (Bac Ninh)" color="#000" align="center" position="0 1.2 0.04" width="3.5"></a-text>
          
          <a-text value="(A) The Electronics Core:\nNear Hanoi, Airport & Port. Critical for export.\n\n(B) Mature Infrastructure:\nReady-made VSIP parks allow fast ramp-up.\n\n(C) Supply Chain Proximity:\nSharing the ecosystem built by Samsung.\n\n(D) Aggregation Phenomenon:\nHighest concentration of Apple suppliers in cluster.\n\n(E) China+1 Strategy:\nFoxconn expanding here for resilience." 
                  color="#e0f7fa" align="left" anchor="center" baseline="top" position="0 0.95 0.04" width="2.5" wrapCount="62" lineHeight="50"></a-text>
          
          <a-text value="[ CLICK TO CLOSE ]" color="#4dd0e1" align="center" position="0 -1.15 0.04" width="2.2"></a-text>
          <a-plane class="clickable" width="2.8" height="2.7" position="0 0 0.05" visible="false" onclick="toggleCard('card-apple')"></a-plane>
        </a-entity>
      </a-entity>

    </a-entity>

    <a-entity camera look-controls="enabled: false" orbit-controls="target: 0 0.8 0; minDistance: 0.1; maxDistance: 10; initialPosition: 0 2 3.5; rotateSpeed: 0.5; zoomSpeed: 2.0; enableZoom: true; enablePan: true; screenSpacePanning: true;"></a-entity>
  </a-scene>

  <script>
    const c1 = document.getElementById('wood-tex').getContext('2d');
    c1.fillStyle = '#6d4c41'; c1.fillRect(0,0,512,512); c1.strokeStyle = '#4e342e'; c1.lineWidth = 3;
    for(let i=0;i<60;i++){c1.beginPath();c1.moveTo(0,Math.random()*512);c1.bezierCurveTo(150,Math.random()*512,350,Math.random()*512,512,Math.random()*512);c1.stroke();}
    const c2 = document.getElementById('floor-tex').getContext('2d');
    c2.fillStyle = '#e0e0e0'; c2.fillRect(0,0,512,512); c2.strokeStyle = '#bdbdbd'; c2.lineWidth = 4;
    c2.strokeRect(0,0,512,512); c2.fillStyle = '#f5f5f5'; c2.fillRect(10,10,230,230); c2.fillRect(260,10,230,230); c2.fillRect(10,260,230,230); c2.fillRect(260,260,230,230);
    const c3 = document.getElementById('wall-tex').getContext('2d');
    c3.fillStyle = '#fdf5e6'; c3.fillRect(0,0,512,512); for(let i=0;i<5000;i++){ c3.fillStyle = Math.random()>0.5 ? '#fff8e1' : '#fff'; c3.fillRect(Math.random()*512, Math.random()*512, 2, 2); }

    function roundRect(ctx, x, y, width, height, radius, fill, stroke, strokeWidth) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
      if (fill) { ctx.fillStyle = fill; ctx.fill(); }
      if (stroke) { ctx.lineWidth = strokeWidth; ctx.strokeStyle = stroke; ctx.stroke(); }
    }
    const ctxUI = document.getElementById('ui-bg-tex').getContext('2d');
    roundRect(ctxUI, 5, 5, 502, 502, 40, 'rgba(0, 59, 70, 0.95)', '#00d2ff', 4);
    const ctxHead = document.getElementById('ui-header-tex').getContext('2d');
    roundRect(ctxHead, 5, 5, 502, 90, 20, '#ffffff', null, 0);

    const flat = document.getElementById('step1-flat');
    const ar = document.getElementById('step2-ar');
    window.activateHologram = function() {
      flat.setAttribute('visible', 'false'); 
      ar.setAttribute('visible', 'true');
      ar.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 1000; easing: easeOutElastic');
    };
    window.toggleCard = function(id) {
      const card = document.getElementById(id);
      const isVisible = card.getAttribute('visible');
      if (isVisible) {
        card.setAttribute('animation', 'property: scale; to: 0 0 0; dur: 300; easing: easeInBack');
        setTimeout(() => card.setAttribute('visible', 'false'), 300);
      } else {
        document.querySelectorAll('[id^="card-"]').forEach(c => {
           if(c.getAttribute('visible')) {
             c.setAttribute('visible', 'false');
             c.setAttribute('scale', '0 0 0');
           }
        });
        card.setAttribute('visible', 'true');
        card.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 500; easing: easeOutBack');
      }
    };
  </script>
</body>
</html>
