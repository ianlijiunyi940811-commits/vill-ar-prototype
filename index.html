<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: War Room V11 (Fixed Zoom)</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; background: #111; }

    /* === UI å±¤ === */
    #ui-layer {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 999;
      display: flex; flex-direction: column; justify-content: space-between;
    }

    /* é ‚éƒ¨æ¨™é¡Œ */
    .header {
      background: rgba(10, 20, 30, 0.9);
      border-bottom: 2px solid #00ffcc;
      padding: 15px 30px;
      display: flex; justify-content: space-between; align-items: center;
      backdrop-filter: blur(5px);
    }
    .title { font-family: 'Rajdhani', sans-serif; color: #00ffcc; font-size: 26px; letter-spacing: 2px; text-shadow: 0 0 10px rgba(0,255,204,0.5); }
    .status { color: white; border: 1px solid #555; padding: 4px 12px; border-radius: 15px; font-size: 13px; background: rgba(0,0,0,0.6); }

    /* è³‡æ–™é¢æ¿ */
    #info-panel {
      position: absolute; top: 15%; right: 20px; width: 320px;
      background: rgba(15, 23, 30, 0.95);
      border-left: 5px solid #00ffcc;
      border-radius: 8px; padding: 25px;
      color: white;
      transform: translateX(130%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      pointer-events: auto;
      box-shadow: -10px 10px 30px rgba(0,0,0,0.6);
    }
    #info-panel.active { transform: translateX(0); }
    
    .panel-h { font-family: 'Rajdhani'; font-size: 22px; color: #00ffcc; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 8px; }
    .panel-b { font-size: 14px; line-height: 1.6; color: #ccc; }

    /* åº•éƒ¨æ“ä½œæç¤º */
    .controls-hint {
      text-align: center; padding: 15px;
      background: linear-gradient(0deg, rgba(0,0,0,0.9), transparent);
      color: #aaa; font-size: 13px;
    }

    /* éŒ¯èª¤æç¤º */
    #error-msg { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:white; color:red; padding:20px; display:none; pointer-events:auto; text-align:center; border-radius:8px; }
  </style>
</head>

<body>
  
  <div id="error-msg">
    <h3>âš ï¸ MISSING MAP.JPG</h3>
    <p>è«‹ç¢ºèªè³‡æ–™å¤¾å…§æœ‰ <b>map.jpg</b></p>
    <button onclick="location.reload()" style="cursor:pointer; padding:5px 10px;">é‡è©¦</button>
  </div>

  <div id="ui-layer">
    <div class="header">
      <div class="title">VILL STRATEGY ROOM</div>
      <div class="status">â— LIVE SIMULATION</div>
    </div>
    
    <div id="info-panel">
      <div class="panel-h" id="node-title">Data Node</div>
      <div class="panel-b" id="node-content">...</div>
    </div>

    <div class="controls-hint">
      ğŸ–±ï¸ æ»¾è¼ª: æ”¾å¤§/ç¸®å° (Zoom) &nbsp;|&nbsp; ğŸ–±ï¸ å·¦éµæ‹–æ›³: æ—‹è½‰ (Rotate) &nbsp;|&nbsp; ğŸ–±ï¸ å³éµæ‹–æ›³: ç§»å‹• (Pan)
    </div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="document.getElementById('error-msg').style.display='block'">
      <canvas id="wood-tex" width="512" height="512"></canvas>
    </a-assets>

    <a-sky color="#1a2634"></a-sky> <a-box position="0 3 0" width="20" height="6" depth="20" material="color: #f0f2f5; side: back;"></a-box>
    <a-plane position="0 0.01 0" rotation="-90 0 0" width="20" height="20" color="#cfd8dc"></a-plane>
    <a-plane position="-9.9 3 0" rotation="0 90 0" width="8" height="3" color="#fff" material="emissive: #fff; emissiveIntensity: 0.8"></a-plane>

    <a-light type="ambient" intensity="0.5"></a-light>
    <a-light type="directional" position="-5 5 2" intensity="0.6" castShadow="true"></a-light>
    <a-light type="spot" position="0 7 0" target="#table" intensity="1.2" penumbra="0.3"></a-light>

    <a-entity id="table" position="0 0 0">
      <a-cylinder position="0 0.8 0" radius="1.8" height="0.1" material="src: #wood-tex; color: #4e342e; roughness: 0.5"></a-cylinder>
      <a-cylinder position="0 0.4 0" radius="0.3" height="0.8" color="#222"></a-cylinder>
      <a-cylinder position="0 0.02 0" radius="1.0" height="0.05" color="#111"></a-cylinder>
    </a-entity>

    <a-entity id="step1-flat" position="0 0.86 0" rotation="-90 0 0">
      <a-plane width="1.2" height="1.6" color="#fff" class="clickable" onclick="activateAR()">
        <a-image src="#map-tex" width="1.1" height="1.5" position="0 0 0.01"></a-image>
        <a-text value="é»æ“Šå•Ÿå‹•å…¨æ¯åœ°åœ–" align="center" position="0 0 0.05" color="red" scale="0.8 0.8 0.8"></a-text>
      </a-plane>
    </a-entity>

    <a-entity id="step2-ar" position="0 1.2 0" visible="false" scale="0.1 0.1 0.1">
      
      <a-ring radius-inner="1.8" radius-outer="1.9" rotation="-90 0 0" color="#00ffcc" position="0 -0.2 0"></a-ring>
      <a-cylinder radius="1.8" height="0.2" color="#00ffcc" material="opacity: 0.1; transparent: true" position="0 -0.1 0"></a-cylinder>

      <a-image src="#map-tex" width="2" height="2.5" rotation="-90 0 0" opacity="0.9"></a-image>

      <a-entity position="-0.2 0.2 -0.6" class="clickable pin" data-id="samsung">
        <a-sphere radius="0.08" color="#ff0055" position="0 0.2 0">
           <a-animation attribute="scale" to="1.2 1.2 1.2" dur="800" dir="alternate" repeat="indefinite"></a-animation>
        </a-sphere>
        <a-cone radius-bottom="0.02" radius-top="0.08" height="0.2" color="#ff0055" position="0 0.1 0"></a-cone>
      </a-entity>

      <a-entity position="0.3 0.2 -0.1" class="clickable pin" data-id="nvidia">
        <a-sphere radius="0.08" color="#00ff00" position="0 0.2 0"></a-sphere>
        <a-cone radius-bottom="0.02" radius-top="0.08" height="0.2" color="#00ff00" position="0 0.1 0"></a-cone>
      </a-entity>

      <a-entity position="0.1 0.2 0.5" class="clickable pin" data-id="intel">
        <a-sphere radius="0.08" color="#00aaff" position="0 0.2 0"></a-sphere>
        <a-cone radius-bottom="0.02" radius-top="0.08" height="0.2" color="#00aaff" position="0 0.1 0"></a-cone>
      </a-entity>

    </a-entity>

    <a-entity 
      camera 
      look-controls="enabled: false"
      orbit-controls="
          target: 0 0.8 0; 
          minDistance: 0.5; 
          maxDistance: 10; 
          initialPosition: 0 2.5 4; 
          rotateSpeed: 0.5; 
          zoomSpeed: 2.0; 
          enableZoom: true; 
          enablePan: true; 
          screenSpacePanning: true;">
    </a-entity>

  </a-scene>

  <script>
    // æœ¨ç´‹ç”Ÿæˆ
    const c = document.getElementById('wood-tex');
    const ctx = c.getContext('2d');
    ctx.fillStyle='#3e2723'; ctx.fillRect(0,0,512,512);
    ctx.strokeStyle='#2e1c18'; ctx.lineWidth=4;
    for(let i=0;i<40;i++){ctx.beginPath();ctx.moveTo(0,Math.random()*512);ctx.bezierCurveTo(150,Math.random()*512,350,Math.random()*512,512,Math.random()*512);ctx.stroke();}

    // äº’å‹•é‚è¼¯
    const flat = document.getElementById('step1-flat');
    const ar = document.getElementById('step2-ar');
    const card = document.getElementById('info-panel');
    const nTitle = document.getElementById('node-title');
    const nContent = document.getElementById('node-content');

    window.activateAR = function() {
      flat.setAttribute('visible', 'false');
      ar.setAttribute('visible', 'true');
      ar.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 800; easing: easeOutBack');
    };

    const db = {
      samsung: { title: "SAMSUNG (Bac Ninh)", body: "åŒ—è¶Šæœ€å¤§å°æ¸¬èšè½ã€‚æŠ•è³‡é¡ $19.2Bï¼Œé„°è¿‘æ©Ÿå ´èˆ‡ä¸­åœ‹é‚Šå¢ƒï¼Œå…·å‚™ä¾›æ‡‰éˆå¿«é€Ÿåæ‡‰å„ªå‹¢ã€‚" },
      nvidia: { title: "NVIDIA (Da Nang)", body: "ä¸­éƒ¨ AI è¨­è¨ˆä¸­å¿ƒã€‚èˆ‡ FPT åˆä½œï¼Œåˆ©ç”¨ç•¶åœ°è±å¯Œçš„å¤§å­¸äººæ‰è³‡æºé€²è¡Œæ™¶ç‰‡è¨­è¨ˆã€‚" },
      intel: { title: "INTEL (Ho Chi Minh)", body: "å—è¶Šå°æ¸¬é‡é® (SHTP)ã€‚å…¨çƒæœ€å¤§ ATM å» ï¼Œæ“æœ‰è¶Šå—æœ€å®Œå–„çš„å·¥æ¥­åŸºç¤è¨­æ–½ã€‚" }
    };

    document.querySelectorAll('.pin').forEach(p => {
      p.addEventListener('click', (e) => {
        e.stopPropagation();
        const d = db[p.getAttribute('data-id')];
        nTitle.innerText = d.title;
        nContent.innerHTML = d.body;
        card.classList.add('active');
      });
      // æ»‘é¼ æ‡¸åœç‰¹æ•ˆ
      p.addEventListener('mouseenter', function() { this.object3D.scale.set(1.3, 1.3, 1.3); });
      p.addEventListener('mouseleave', function() { this.object3D.scale.set(1, 1, 1); });
    });

    document.querySelector('a-scene').addEventListener('click', (e) => {
      if(!e.target.closest('.clickable')) card.classList.remove('active');
    });
  </script>
</body>
</html>
