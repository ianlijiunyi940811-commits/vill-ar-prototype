<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VILL: Final Stable Simulator</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&family=Noto+Sans+TC:wght@400;700&display=swap');
    body { margin: 0; overflow: hidden; font-family: 'Noto Sans TC', sans-serif; background-color: #1a1a1a; }

    /* === UI å±¤ === */
    #ui-layer {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 999;
      display: flex; flex-direction: column; justify-content: space-between;
    }

    /* é ‚éƒ¨æ¨™é¡Œ */
    .header {
      background: rgba(0, 0, 0, 0.85);
      border-bottom: 2px solid #00d2ff;
      padding: 15px 30px;
      display: flex; justify-content: space-between; align-items: center;
      backdrop-filter: blur(4px);
    }
    .title { color: #00d2ff; font-family: 'Rajdhani', sans-serif; font-size: 24px; font-weight: bold; letter-spacing: 1px; }
    .subtitle { color: #aaa; font-size: 14px; margin-left: 10px; }

    /* å³å´è³‡æ–™é¢æ¿ */
    #info-panel {
      position: absolute; top: 15%; right: 20px; width: 300px;
      background: rgba(20, 30, 40, 0.95);
      border: 1px solid #444; border-left: 5px solid #00d2ff;
      border-radius: 8px; padding: 20px;
      color: white;
      transform: translateX(120%); transition: transform 0.3s ease-out;
      pointer-events: auto; /* å…è¨±é»æ“Š */
      box-shadow: -5px 5px 20px rgba(0,0,0,0.5);
    }
    #info-panel.active { transform: translateX(0); }

    .panel-h { color: #00d2ff; font-size: 20px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #555; padding-bottom: 5px; font-family: 'Rajdhani'; }
    .panel-b { font-size: 14px; line-height: 1.5; color: #ddd; }

    /* åº•éƒ¨æ“ä½œæç¤º */
    .controls-hint {
      text-align: center; padding: 15px;
      background: rgba(0,0,0,0.8); color: #ccc; font-size: 13px;
    }
    
    /* æŒ‰éˆ•æ¨£å¼ */
    .btn { background: #00d2ff; color: black; border: none; padding: 5px 10px; cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 10px; }
  </style>
</head>

<body>

  <div id="ui-layer">
    <div class="header">
      <div><span class="title">VILL SYSTEM</span><span class="subtitle">Semiconductor Strategy Sim</span></div>
      <div style="background:#00d2ff; color:black; font-size:12px; padding:3px 8px; border-radius:3px; font-weight:bold;">LIVE</div>
    </div>

    <div id="info-panel">
      <div class="panel-h" id="p-title">Data Node</div>
      <div class="panel-b" id="p-content">...</div>
      <button class="btn" onclick="document.getElementById('info-panel').classList.remove('active')">é—œé–‰</button>
    </div>

    <div class="controls-hint">
      ğŸ–±ï¸ æ»¾è¼ª: æ”¾å¤§ç¸®å° | ğŸ–±ï¸ å·¦éµæ‹–æ›³: æ—‹è½‰ | ğŸ–±ï¸ å³éµæ‹–æ›³: å¹³ç§» | ğŸ‘† é»æ“Šæ¨™è¨˜æŸ¥çœ‹æ•¸æ“š
    </div>
  </div>

  <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <img id="map-tex" src="./map.jpg" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Vietnam_location_map_topographic.png/640px-Vietnam_location_map_topographic.png'">
      <canvas id="floor-tex" width="512" height="512"></canvas>
    </a-assets>

    <a-sky color="#121212"></a-sky>
    
    <a-entity id="room">
      <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" material="src:#floor-tex; roughness:0.6; color:#888"></a-plane>
      <a-plane position="0 5 0" rotation="90 0 0" width="20" height="20" color="#333"></a-plane>
      <a-plane position="0 2.5 -6" width="20" height="5" color="#e0e0e0"></a-plane> <a-plane position="-6 2.5 0" rotation="0 90 0" width="20" height="5" color="#d0d0d0"></a-plane> <a-plane position="6 2.5 0" rotation="0 -90 0" width="20" height="5" color="#d0d0d0"></a-plane> <a-plane position="-5.9 2.5 0" rotation="0 90 0" width="4" height="2" color="#fff" material="emissive:#fff; emissiveIntensity:0.5"></a-plane>
    </a-entity>

    <a-light type="ambient" intensity="0.6"></a-light>
    <a-light type="directional" position="-2 4 2" intensity="0.5" castShadow="true"></a-light>
    <a-light type="spot" position="0 6 0" target="#table" intensity="1.2" penumbra="0.5"></a-light>

    <a-entity id="table" position="0 0 0">
      <a-cylinder position="0 0.8 0" radius="1.5" height="0.05" color="#3e2723" material="roughness:0.4"></a-cylinder>
      <a-cylinder position="0 0.4 0" radius="0.2" height="0.8" color="#111"></a-cylinder>
      <a-cylinder position="0 0.02 0" radius="0.8" height="0.05" color="#111"></a-cylinder>
      <a-torus position="0 0.8 0" rotation="90 0 0" radius="1.5" radius-tubular="0.01" color="#00d2ff" material="emissive:#00d2ff; emissiveIntensity:1"></a-torus>
    </a-entity>

    <a-entity id="step1-flat" position="0 0.84 0" rotation="-90 0 0">
      <a-plane width="1.2" height="1.6" color="#fff" class="clickable" onclick="startAR()">
        <a-image src="#map-tex" width="1.1" height="1.5" position="0 0 0.01"></a-image>
        <a-text value="CLICK TO START" align="center" position="0 0 0.1" color="red" scale="0.8 0.8 0.8"></a-text>
      </a-plane>
    </a-entity>

    <a-entity id="step2-ar" position="0 1.2 0" visible="false" scale="0.1 0.1 0.1">
      
      <a-image src="#map-tex" width="1.5" height="2" rotation="-90 0 0" opacity="0.95"></a-image>
      
      <a-plane width="1.5" height="0.05" rotation="-90 0 0" color="#00d2ff" opacity="0.3" position="0 0.05 0">
         <a-animation attribute="position" from="0 0.05 -0.8" to="0 0.05 0.8" dur="2000" dir="alternate" repeat="indefinite"></a-animation>
      </a-plane>

      <a-entity position="-0.2 0.2 -0.5" class="clickable pin" data-id="samsung">
        <a-box visible="false" width="0.2" height="0.5" depth="0.2"></a-box> 
        <a-sphere radius="0.08" color="#ff0055" position="0 0.1 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.08" height="0.2" color="#ff0055" position="0 0 0"></a-cone>
      </a-entity>

      <a-entity position="0.3 0.2 0" class="clickable pin" data-id="nvidia">
        <a-box visible="false" width="0.2" height="0.5" depth="0.2"></a-box>
        <a-sphere radius="0.08" color="#00ff00" position="0 0.1 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.08" height="0.2" color="#00ff00" position="0 0 0"></a-cone>
      </a-entity>

      <a-entity position="0.1 0.2 0.6" class="clickable pin" data-id="intel">
        <a-box visible="false" width="0.2" height="0.5" depth="0.2"></a-box>
        <a-sphere radius="0.08" color="#00aaff" position="0 0.1 0"></a-sphere>
        <a-cone radius-bottom="0.01" radius-top="0.08" height="0.2" color="#00aaff" position="0 0 0"></a-cone>
      </a-entity>

    </a-entity>

    <a-entity camera look-controls="enabled: false" 
              orbit-controls="target: 0 0.8 0; minDistance: 0.1; maxDistance: 10; initialPosition: 0 2 3; zoomSpeed: 1.5; enablePan: true; screenSpacePanning: true;">
    </a-entity>

  </a-scene>

  <script>
    // ç¹ªè£½åœ°æ¿ç´‹ç†
    const ctx = document.getElementById('floor-tex').getContext('2d');
    ctx.fillStyle = '#555'; ctx.fillRect(0,0,512,512);
    ctx.strokeStyle = '#444'; ctx.lineWidth = 2;
    for(let i=0; i<512; i+=50){ ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(512,i); ctx.stroke(); ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,512); ctx.stroke(); }

    // äº’å‹•é‚è¼¯
    const flat = document.getElementById('step1-flat');
    const ar = document.getElementById('step2-ar');
    const panel = document.getElementById('info-panel');
    const pTitle = document.getElementById('p-title');
    const pContent = document.getElementById('p-content');

    // å•Ÿå‹• 3D
    window.startAR = function() {
      flat.setAttribute('visible', 'false');
      ar.setAttribute('visible', 'true');
      ar.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 1000; easing: easeOutElastic');
    };

    // è³‡æ–™åº«
    const db = {
      samsung: { title: "NORTH: SAMSUNG", body: "åœ°é»ï¼šåŒ—å¯§ (Bac Ninh)<br>æŠ•è³‡ï¼š$192 å„„ç¾å…ƒ<br>é‡é»ï¼šæ‰‹æ©Ÿçµ„è£ã€ç ”ç™¼ä¸­å¿ƒ<br>å„ªå‹¢ï¼šé„°è¿‘ä¸­åœ‹ä¾›æ‡‰éˆï¼Œå…·å‚™å¿«é€Ÿåæ‡‰èƒ½åŠ›ã€‚" },
      nvidia: { title: "CENTRAL: NVIDIA", body: "åœ°é»ï¼šå³´æ¸¯ (Da Nang)<br>åˆä½œï¼šFPT<br>é‡é»ï¼šAI æ™¶ç‰‡è¨­è¨ˆ<br>å„ªå‹¢ï¼šåˆ©ç”¨ä¸­éƒ¨å¤§å­¸äººæ‰åº«ï¼Œç™¼å±•è»Ÿé«”èˆ‡ IC è¨­è¨ˆã€‚" },
      intel: { title: "SOUTH: INTEL", body: "åœ°é»ï¼šèƒ¡å¿—æ˜å¸‚ (SHTP)<br>è¨­æ–½ï¼šATM å°æ¸¬å» <br>é‡é»ï¼šå°è£æ¸¬è©¦<br>å„ªå‹¢ï¼šåŸºç¤è¨­æ–½æœ€å®Œå–„ï¼Œå‡ºå£ç‰©æµä¾¿æ·ã€‚" }
    };

    // ç¶å®šé»æ“Š
    document.querySelectorAll('.pin').forEach(pin => {
      pin.addEventListener('click', function(e) {
        e.stopPropagation(); // é˜²æ­¢é»ç©¿
        const data = db[this.getAttribute('data-id')];
        pTitle.innerHTML = data.title;
        pContent.innerHTML = data.body;
        panel.classList.add('active');
      });
      // æ»‘é¼ æ‡¸åœè®Šå¤§
      pin.addEventListener('mouseenter', function() { this.setAttribute('scale', '1.3 1.3 1.3'); });
      pin.addEventListener('mouseleave', function() { this.setAttribute('scale', '1 1 1'); });
    });

  </script>
</body>
</html>
